# indexing
## Motivation
- databasesì—ì„œì˜ indexëŠ” ë¬´ì—‡ì¸ê°€?
  - ì°¾ê³ ì í•˜ëŠ” recordsë¥¼ ë¹ ë¥´ê²Œ ì°¾ê¸° ìœ„í•´ ì„¤ê³„ëœ data structureì´ë‹¤.
  - ì™œ ê·¸ë ‡ê²Œ ë§ì€ ì¢…ë¥˜ì˜ ì¸ë±ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ”ê°€?
    - ë‹¤ì–‘í•œ data types
    - ë‹¤ì–‘í•œ queries
  - ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ í•˜ëŠ” ì¼ì€ ê¸°ë°˜ ë°ì´í„°ì— ì ì ˆí•œ ì¸ë±ìŠ¤ë¥¼ ì„¤ê³„í•˜ê³  í™œìš©í•˜ëŠ” ê²ƒì´ë‹¤.
- indexê°€ í•„ìš”í•œ ì´ìœ ëŠ”?
  - ë‹¤ìŒê³¼ ê°™ì€ queryë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œì´ë‹¤.
    ```sql
    select name, dept_name, salary
    from instructor 
    where ID = 15151;
    ```

## Basic Concepts
- ì›í•˜ëŠ” dataì— ëŒ€í•œ ì ‘ê·¼ì„ ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” indexing mechanisms
- Search Key: fileì—ì„œ recordsë¥¼ ì°¾ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ attribute
- index fileì€ ë‹¤ìŒ í˜•íƒœì˜ records(index entriesë¼ê³  ë¶€ë¦„)ë¡œ êµ¬ì„±ëœë‹¤.<br>
  ![image](https://github.com/user-attachments/assets/8aff93f6-a41b-4036-985f-a4cacb5cc985)<br>
  index fileì€ ìœ„ì™€ ê°™ì€ í˜•íƒœë¡œ ì´ë£¨ì–´ì§„ë‹¤.
- Index filesì€ ì¼ë°˜ì ìœ¼ë¡œ original fileë³´ë‹¤ ì‘ë‹¤.
- indicesì˜ 2ê°€ì§€ ê¸°ë³¸ ì¢…ë¥˜:
  - Ordered indices(ìˆœì°¨ ì¸ë±ìŠ¤): search keysê°€ ì •ë ¬ëœ ìˆœì„œë¡œ ì €ì¥ëœë‹¤.
  - Hash indices(í•´ì‹œ ì¸ë±ìŠ¤): search keysê°€ hash functionë¥¼ ì‚¬ìš©í•˜ì—¬ bucketsë“¤ì— ê· ë“±í•˜ê²Œ ë¶„ë°°ëœë‹¤.

## Index Evaluation Metrics
- íš¨ìœ¨ì ìœ¼ë¡œ ì§€ì›ë˜ëŠ” ì ‘ê·¼ ìœ í˜•
  - íŠ¹ì • ì†ì„± ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œë“¤ -> name = 'Alice'ì¸ ê²ƒì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆëŠ”ê°€?
  - ì†ì„± ê°’ì´ íŠ¹ì • ë²”ìœ„ ë‚´ì— í¬í•¨ë˜ëŠ” ë ˆì½”ë“œë“¤ -> ageê°€ 20 ~ 30ì‚¬ì´ì¸ ê°’ì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆëŠ”ê°€?
- Access time -> ì°¾ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- Insertion time -> ì‚½ì…í•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- Deletion time -> ì‚­ì œí•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- Space overhead -> ì¶”ê°€ì ìœ¼ë¡œ ê³µê°„ì´ í•„ìš”í•˜ì§€ ì•Šì€ì§€? <br>
- ì¸ë±ìŠ¤ì˜ ì„±ëŠ¥ì„ ì´ë¡ ì ìœ¼ë¡œ ì–´ë–»ê²Œ ë¶„ì„í•  ê²ƒì¸ê°€? <br>
  ì™¸ë¶€ ë©”ëª¨ë¦¬ ëª¨ë¸ (ê°•ì˜ ë…¸íŠ¸ ì°¸ê³ )<br>
  ![image](https://github.com/user-attachments/assets/8a486c04-4d8f-44e7-875d-338b4e590e5b)

## Ordered Indices
- ordered index(ìˆœì°¨ ì¸ë±ìŠ¤): index entriesê°€ search key valueì— ë”°ë¼ ì •ë ¬ëœ ìƒíƒœë¡œ ì €ì¥ëœë‹¤.<br>
  ì¦‰, data ê¸°ì¤€ì— ë”°ë¼ ì •ë ¬-> ê·¸ê±¸ indexë¡œ ë§Œë“ ë‹¤.
- primary index(ê¸°ë³¸ ì¸ë±ìŠ¤): ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬ëœ íŒŒì¼ì—ì„œ, search keyê°€ fileì˜ ì •ë ¬ ìˆœì„œë¥¼ ì§€ì •í•˜ëŠ” index
  - clustering index(í´ëŸ¬ìŠ¤í„°ë§ ì¸ë±ìŠ¤) ë¼ê³ ë„ ë¶ˆë¦°ë‹¤
  - primary indexì˜ search keyëŠ” ì¼ë°˜ì ìœ¼ë¡œ primary keyì´ì§€ë§Œ ë°˜ë“œì‹œ ê·¸ëŸ° ê²ƒì€ ì•„ë‹ˆë‹¤
- ë³´ì¡° ì¸ë±ìŠ¤(secondary index): search keyê°€ íŒŒì¼ì˜ ìˆœì°¨ì ì¸ ì •ë ¬ ìˆœì„œì™€ ë‹¤ë¥¸ ìˆœì„œë¥¼ ì§€ì •í•˜ëŠ” indexì´ë‹¤.<br>
ì¦‰, dataë¥¼ ì •ë ¬í•˜ì§€ë§Œ, indexëŠ” ì •ë ¬ì•ˆëœ ë‹¤ë¥¸ê±¸ë¡œ
  - non-clustering indexë¼ê³ ë„ ë¶ˆë¦°ë‹¤
- ì¸ë±ìŠ¤-ìˆœì°¨ íŒŒì¼(index-sequential file): primary indexë¥¼ ê°–ëŠ” ì •ë ¬ëœ ìˆœì°¨ íŒŒì¼

## Dense Index Files(index êµ¬ë¶„ ì†ì„± dense VS sparse)
- Dense index: fileì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  search-key valueë§ˆë‹¤ Index recordê°€ ì¡´ì¬í•˜ëŠ” index.<br>
ì „ë¶€ ê°™ì´ ì¡´ì¬í•´ì„œ ë°€ë„ê°€ ë†’ë‹¤.
- Dense index on dept_name, with instructor file sorted on dept_name<br>
![image](https://github.com/user-attachments/assets/04433090-5e83-4f9f-9339-de499060a129)
- dept_name ì†ì„±ì— ëŒ€í•œ dense index, instructor íŒŒì¼ì´ dept_name ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì„ ë•Œ<br>
![image](https://github.com/user-attachments/assets/9210c826-168a-474c-a01e-e76c2ee3076c)<br>
ê°™ì„ í•„ìš”ê°€ì—†ë‹¤ëŠ” ê²ƒì€ ì¤‘ë³µì´ ë˜ê¸°ë•Œë¬¸ì— ê·¸ëŸ°ê²ƒ

## Sparse Index Files(ë°˜ë“œì‹œ primary indexì´ë‹¤)
- Sparse Index: ì¼ë¶€ search-key valuesì— ëŒ€í•´ì„œë§Œ ì¸ë±ìŠ¤ recordsë¥¼ í¬í•¨í•˜ëŠ” index
  - search-keyë¥¼ ê¸°ì¤€ìœ¼ë¡œ recordsê°€ ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì„ ë•Œ ì ìš© ê°€ëŠ¥
- search-key value Kë¥¼ ê°€ì§„ recordsë¥¼ ì°¾ê¸° ìœ„í•´ì„œëŠ”:
  - Kë³´ë‹¤ ì‘ìœ¼ë©´ì„œ ê°€ì¥ í° search-key valueì„ ê°€ì§„ index recordë¥¼ ì°¾ê³ 
  - í•´ë‹¹ ì¸ë±ìŠ¤ ë ˆì½”ë“œê°€ ê°€ë¦¬í‚¤ëŠ” ë ˆì½”ë“œë¶€í„° íŒŒì¼ì„ ìˆœì°¨ì ìœ¼ë¡œ ê²€ìƒ‰í•œë‹¤<br>
![image](https://github.com/user-attachments/assets/e74dedcb-435a-4769-81ac-053deba5a8b8)<br>
- Compared to dense indices:
  - ê³µê°„ì„ ëœ ì°¨ì§€í•˜ê³ , ì‚½ì… ë° ì‚­ì œ ì‹œ ìœ ì§€ ê´€ë¦¬ ë¹„ìš©ì´ ë” ì ë‹¤.
  - ë ˆì½”ë“œë¥¼ ì°¾ëŠ” ì†ë„ëŠ” ì¼ë°˜ì ìœ¼ë¡œ dense indexë³´ë‹¤ ëŠë¦¬ë‹¤.
 - ì ˆì¶©ì•ˆ: íŒŒì¼ì˜ ê° ë¸”ë¡ë§ˆë‹¤, í•´ë‹¹ ë¸”ë¡ì—ì„œì˜ ê°€ì¥ ì‘ì€ search-key valueì— ëŒ€ì‘í•˜ëŠ”
   ì¸ë±ìŠ¤ í•­ëª©ì„ í•˜ë‚˜ì”© ê°–ëŠ” sparse index.<br>
![image](https://github.com/user-attachments/assets/89366540-9434-4e3b-a3d2-9cafe3c0dcf6)<br>

## Multilevel Index
- ê¸°ë³¸ ì¸ë±ìŠ¤(primary index)ê°€ ë©”ëª¨ë¦¬ì— ëª¨ë‘ ë“¤ì–´ê°€ì§€ ì•Šìœ¼ë©´, ì ‘ê·¼ ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤.
- Solution: ë””ìŠ¤í¬ì— ì €ì¥ëœ ê¸°ë³¸ ì¸ë±ìŠ¤ë¥¼ ìˆœì°¨ íŒŒì¼(sequential file)ë¡œ ë³´ê³ , ê·¸ ìœ„ì— í¬ì†Œ ì¸ë±ìŠ¤(sparse index)ë¥¼ ìƒì„±í•œë‹¤.
  - outer index: ê¸°ë³¸ ì¸ë±ìŠ¤(primary index)ì˜ í¬ì†Œ ì¸ë±ìŠ¤(sparse index)
  - inner index: ì‹¤ì œ ê¸°ë³¸ ì¸ë±ìŠ¤ íŒŒì¼(primary index file)
- ë§Œì•½ ì™¸ë¶€ ì¸ë±ìŠ¤ì¡°ì°¨ ë©”ì¸ ë©”ëª¨ë¦¬ì— ë“¤ì–´ê°€ì§€ ì•Šì„ ì •ë„ë¡œ í¬ë‹¤ë©´, ë˜ í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ ë ˆë²¨ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
- ëª¨ë“  ë ˆë²¨ì˜ ì¸ë±ìŠ¤ëŠ” íŒŒì¼ì— ì‚½ì…(insert) ë˜ëŠ” ì‚­ì œ(delete)ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ í•¨ê»˜ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•œë‹¤<br>
![image](https://github.com/user-attachments/assets/3cd4fa88-daef-4545-8bc6-93b7fdc59db5) <br>
![image](https://github.com/user-attachments/assets/861b5780-b99d-42f2-8f34-2f24ec76d0b2) <br>
![image](https://github.com/user-attachments/assets/abc717b8-9aaa-403a-a3a0-cf0a6ddd2fc5) <br>
ì¦‰, indexì˜ indexë¥¼ ë§Œë“œëŠ” mutil indexêµ¬ì¡°ì´ë‹¤. <br>
I/O costì˜ log ë°‘ì´ 2ì¸ ì´ìœ : ì´ì§„íƒìƒ‰ì„ í•˜ëŠ”ë° ì „ì²´ ë°ì´í„°Nì—ì„œ ì´ì§„íƒìƒ‰ì„ í†µí•´ í•´ë‹¹ ë¸”ë¡ì˜ ê°œìˆ˜Bê¹Œì§€ì˜ íƒìƒ‰ì„ í•˜ëŠ” ê²½ìš°ì´ë‹¤(??) ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì‹ì´ ë‚˜ì™”ë‹¤.<br>
ë”°ë¼ì„œ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë°ì´í„°ê°€ ë“¤ì–´ ìˆëŠ” ë¸”ë¡ì„ ì°¾ê¸° ìœ„í•´ ë””ìŠ¤í¬ì—ì„œ ì½ì–´ì•¼ í•˜ëŠ” íšŸìˆ˜ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ë¸”ë¡ ë‚´ë¶€ëŠ” ìƒê°ì•ˆí•œ ê²½ìš°ì¸ë“¯. <br>

![image](https://github.com/user-attachments/assets/b0454c03-e7c6-4725-a18a-81e5d1a1777a)<br>
![image](https://github.com/user-attachments/assets/c53cfacb-30d7-47ad-a8a5-3e350441aee3)

## Index Update: Deletion
- ì‚­ì œëœ ë ˆì½”ë“œê°€ í•´ë‹¹ ê²€ìƒ‰ í‚¤ ê°’ì„ ê°€ì§„ íŒŒì¼ ë‚´ ìœ ì¼í•œ ë ˆì½”ë“œì˜€ë‹¤ë©´, ê·¸ ê²€ìƒ‰ í‚¤ë„ ì¸ë±ìŠ¤ì—ì„œ ì‚­ì œëœë‹¤.
- Single-level index entry deletion:
  - Dense indices: ê²€ìƒ‰ í‚¤(search-key) ì‚­ì œëŠ” íŒŒì¼ ë ˆì½”ë“œ ì‚­ì œ(file record deletion)ì™€ ìœ ì‚¬í•˜ë‹¤.
  - Sparse indices
    - ì¸ë±ìŠ¤ì— í•´ë‹¹ ê²€ìƒ‰ í‚¤(search key) í•­ëª©ì´ ì¡´ì¬í•˜ë©´, ê·¸ í•­ëª©ì€ íŒŒì¼ ë‚´ next search-key value(in search key order)ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì‚­ì œí•œë‹¤.<br>
    ì˜ˆë¡œ D -> (4 D,5 E,6 F)ì¼ë–„ Dë¥¼ ì‚­ì œí•œë‹¤ë©´ DëŒ€ì‹  Eë¡œ ëŒ€ì²´í•œë‹¤.
    - ë§Œì•½ next search-key valueì´ ì´ë¯¸ ì¸ë±ìŠ¤ í•­ëª©ìœ¼ë¡œ ì¡´ì¬í•œë‹¤ë©´, ëŒ€ì²´í•˜ì§€ ì•Šê³  í•´ë‹¹ í•­ëª©ì„ ì‚­ì œí•œë‹¤. <br>
    ì˜ˆë¡œ D -> (4, D) E -> (5 E, 6 F) ì´ê³ , Dì™€ Eê°€ ê°ê° íŠ¹ì • ë¶€ë¶„ì„ ëŒ€í‘œí•˜ëŠ” ê²½ìš°ì¼ë•Œ ê·¸ëƒ¥ Dë§Œ ì‚­ì œí•œë‹¤. <br>

![image](https://github.com/user-attachments/assets/c779aec2-3e59-47fb-b331-5df5bf9d647b)<br>
DB ì¸ë±ìŠ¤(í˜¹ì€ ë°ì´í„°) ë¸”ë¡ ê´€ë¦¬ì—ì„œ ì‚­ì œê°€ ë°˜ë³µë˜ë©´ ë¸”ë¡ì— ë¹ˆ ê³µê°„ì´ ìƒê¸´ë‹¤. <br>
ì‚½ì… ì‹œ ê¸°ì¡´ ë¸”ë¡ì˜ ë¹ˆ ê³µê°„ì„ í™œìš©í•˜ì§€ ì•Šê³  ìƒˆ ë¸”ë¡ì„ ë§Œë“œëŠ” ê²½ìš°, ì „ì²´ì ìœ¼ë¡œ ê³µê°„ì´ ë‚­ë¹„ë©ë‹ˆë‹¤. <br>
ê·¸ë˜ì„œ ê·¹ë‹¨ì ì¸ ê²½ìš°ë¡œ 1ê°œì”©ë§Œ ìˆëŠ” ê²½ìš°ëŠ” ì „ì²´ì˜ ê°œìˆ˜ê°€ ì¤„ì§€ì•Šê²Œ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. -> ê³µê°„ ë¹„íš¨ìœ¨ <br>
ë”°ë¼ì„œ ì–´ëŠ ì •ë„ ë¸”ë¡ì„ ì±„ìš°ëŠ” ì •ì±…(ì˜ˆ: fill factor ë“±)ì„ ì ìš©í•´ì•¼ í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ DBì˜ ì €ì¥ íš¨ìœ¨ì´ í¬ê²Œ ì €í•˜ë©ë‹ˆë‹¤.

## Index Update: Insertion 
- Single-level index insertion:
  - ì‚½ì…í•  ë ˆì½”ë“œì— ë‚˜íƒ€ë‚˜ëŠ” ê²€ìƒ‰ í‚¤ ê°’(search-key value)ì„ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒë¥¼ ìˆ˜í–‰í•œë‹¤.
  - Dense indices: ê²€ìƒ‰ í‚¤ ê°’ì´ ì¸ë±ìŠ¤ì— ì—†ë‹¤ë©´ ì‚½ì…í•œë‹¤.
  - Sparse indices: ì¸ë±ìŠ¤ê°€ íŒŒì¼ì˜ ê° ë¸”ë¡ì— ëŒ€í•œ í•­ëª©ë§Œ ì €ì¥í•œë‹¤ë©´, ìƒˆë¡œìš´ ë¸”ë¡ì´ ìƒì„±ë˜ì§€ ì•ŠëŠ” í•œ ì¸ë±ìŠ¤ì— ë³€ê²½ì„ ê°€í•  í•„ìš”ê°€ ì—†ë‹¤.
    - ìƒˆë¡œìš´ ë¸”ë¡ì´ ìƒì„±ë˜ë©´, í•´ë‹¹ ë¸”ë¡ì— ì²˜ìŒ ë‚˜íƒ€ë‚˜ëŠ” ê²€ìƒ‰ í‚¤ ê°’ì„ ì¸ë±ìŠ¤ì— ì‚½ì…í•œë‹¤.
- Multilevel insertion and deletion: ì•Œê³ ë¦¬ì¦˜ì€ ë‹¨ì¼ ìˆ˜ì¤€ ì•Œê³ ë¦¬ì¦˜ì˜ ë‹¨ìˆœí•œ í™•ì¥ì´ë‹¤.

## Secondary Indices
- í”íˆ ì–´ë–¤ í•„ë“œ(ê¸°ë³¸ ì¸ë±ìŠ¤ì˜ search-keyê°€ ì•„ë‹Œ)ì˜ ê°’ì´ íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ëª¨ë“  ë ˆì½”ë“œë¥¼ ì°¾ê³ ì í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.
  - Example 1: ID ê¸°ì¤€ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥ëœ instructor ë¦´ë ˆì´ì…˜ì—ì„œ, íŠ¹ì • í•™ê³¼ì— ì†í•œ ëª¨ë“  êµìˆ˜ë¥¼ ì°¾ê³ ì í•  ìˆ˜ ìˆë‹¤.
  - Example 2: ìœ„ì™€ ê°™ì§€ë§Œ, íŠ¹ì • ê¸‰ì—¬ë¥¼ ë°›ëŠ” êµìˆ˜ë‚˜ íŠ¹ì • ë²”ìœ„ì˜ ê¸‰ì—¬ë¥¼ ë°›ëŠ” ëª¨ë“  êµìˆ˜ë¥¼ ì°¾ê³ ì í•˜ëŠ” ê²½ìš°ì´ë‹¤.
- ì´ëŸ¬í•œ ê²½ìš°, ê° ê²€ìƒ‰ í‚¤ ê°’(search-key value)ì— ëŒ€í•´ ì¸ë±ìŠ¤ ë ˆì½”ë“œë¥¼ ê°€ì§€ëŠ” ë³´ì¡° ì¸ë±ìŠ¤(secondary index)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. <br>

## Secondary Indices Example
![image](https://github.com/user-attachments/assets/0a6111d0-4b61-4e77-bee1-067074db0813) <br>
- Index recordëŠ” í•´ë‹¹ ê²€ìƒ‰ í‚¤ ê°’(search-key value)ì„ ê°€ì§„ ì‹¤ì œ ë ˆì½”ë“œë“¤ì„ ëª¨ë‘ ê°€ë¦¬í‚¤ëŠ” pointersê°€ ë“¤ì–´ ìˆëŠ” ë²„í‚·(bucket)ì„ ê°€ë¦¬í‚¨ë‹¤.
- ë³´ì¡° ì¸ë±ìŠ¤(secondary index)ëŠ” ë°˜ë“œì‹œ ë°€ì§‘ ì¸ë±ìŠ¤(dense index)ì—¬ì•¼ í•œë‹¤.

## Primary and Secondary Indices
- indexëŠ” ë ˆì½”ë“œë¥¼ ê²€ìƒ‰í•  ë•Œ ìƒë‹¹í•œ ì´ì ì„ ì œê³µí•œë‹¤.
- BUT: Updating indicesì€ ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì • ì‹œ ì˜¤ë²„í—¤ë“œë¥¼ ì´ˆë˜í•œë‹¤ â€”> íŒŒì¼ì´ ìˆ˜ì •ë˜ë©´, ê·¸ íŒŒì¼ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ì¸ë±ìŠ¤ë¥¼ ê°±ì‹ í•´ì•¼ í•œë‹¤.
- primary indexë¥¼ ì‚¬ìš©í•œ Sequential scanì€ íš¨ìœ¨ì ì´ì§€ë§Œ, secondary indexë¥¼ ì‚¬ìš©í•œ ìˆœì°¨ ìŠ¤ìº”ì€ ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤.
  - ê° recordë¥¼ ì ‘ê·¼í•  ë•Œë§ˆë‹¤ diskì—ì„œ new blockì„ ê°€ì ¸ì™€ì•¼ í•  ìˆ˜ ìˆë‹¤.
  - blockì„ ê°€ì ¸ì˜¤ëŠ” ë°ëŠ” ì•½ 5~10ë°€ë¦¬ì´ˆê°€ ê±¸ë¦¬ë©°, ì´ëŠ” ë©”ëª¨ë¦¬ ì ‘ê·¼ ì‹œê°„ì¸ ì•½ 100ë‚˜ë…¸ì´ˆì— ë¹„í•´ í›¨ì”¬ ëŠë¦¬ë‹¤.
- ì •ë ¬ì„ ì‹œí‚¨ë‹¤. -> cost: $O\left(\frac{N}{B} \log_{\frac{N}{B}} \frac{N}{B}\right)$ - O(N) I/O's ë³´ë‹¤ ì‘ë‹¤.

## $B^+$-Tree Index Files
- $B^+$-tree indicesëŠ” ì¸ë±ìŠ¤ ìˆœì°¨ íŒŒì¼(indexed-sequential files)ì˜ ëŒ€ì•ˆì´ë‹¤.
  - indexed-sequential filesì˜ ë‹¨ì 
    - fileì´ ì»¤ì§ˆìˆ˜ë¡ ë§ì€ overflow blockì´ ìƒì„±ë˜ì–´ performanceê°€ ì €í•˜ëœë‹¤.
    - ì „ì²´ íŒŒì¼ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì¬êµ¬ì„±(reorganization)í•´ì•¼ í•œë‹¤.
  - $B^+$-tree indices íŒŒì¼ì˜ ì¥ì :
    - ì‚½ì…ê³¼ ì‚­ì œê°€ ë°œìƒí•´ë„ ì‘ì€ ì§€ì—­ì  ë³€ê²½ë§Œìœ¼ë¡œ ìë™ìœ¼ë¡œ ì¬êµ¬ì„±(reorganizes)ëœë‹¤. -> ë³€í™”ê°€ ìˆëŠ” ë¶€ë¶„ë§Œ ìë™ìœ¼ë¡œ ì¬êµ¬ì„±í•œë‹¤.
    - ì„±ëŠ¥ ìœ ì§€ë¥¼ ìœ„í•´ ì „ì²´ íŒŒì¼ì„ ì¬êµ¬ì„±(Reorganization of entire file)í•  í•„ìš”ê°€ ì—†ë‹¤.
  - $B^+$-íŠ¸ë¦¬ì˜ (ì‚¬ì†Œí•œ) ë‹¨ì :
    - ì‚½ì… ë° ì‚­ì œì— ì¶”ê°€ì ì¸ overheadì™€ ê³µê°„ overheadê°€ ìˆë‹¤.
  - $B^+$-íŠ¸ë¦¬ì˜ ì¥ì ì´ ë‹¨ì ë³´ë‹¤ í¬ë©°,
    - $B^+$-íŠ¸ë¦¬ëŠ” ë„ë¦¬ ì‚¬ìš©ë˜ê³  ìˆë‹¤.
   
## Example of $B^+$-Tree(dense, sparse ë‹¤ ê°€ëŠ¥í•˜ë‹¤)
![image](https://github.com/user-attachments/assets/14840478-5261-429e-8ffe-65b7568b87c7) <br>
![image](https://github.com/user-attachments/assets/347be7ba-d695-4835-bb8f-877602490b7f) <br>
![image](https://github.com/user-attachments/assets/9983d4ca-7b14-4322-86ca-942c20f817a4)

## $B^+$-Tree Index Files (Cont.) 
- $B^+$-treeëŠ” ë‹¤ìŒ íŠ¹ì„±ì„ ë§Œì¡±í•˜ëŠ” rootê°€ ìˆëŠ” treeì´ë‹¤:
- rootì—ì„œ leafê¹Œì§€ ëª¨ë“  pathsì˜ lengthê°€ ê°™ë‹¤.
- rootë‚˜ leafê°€ ì•„ë‹Œ nodeëŠ” childrenì˜ ìˆ˜ê°€ $\left\lceil \frac{n}{2} \right\rceil$ ì´ìƒ n ì´í•˜ì´ë‹¤.
- leaf nodeëŠ” ê°’ì˜ ê°œìˆ˜ê°€ $\left\lceil \frac{(n-1)}{2} \right\rceil$ ì´ìƒ nâ€“1 ì´í•˜ì´ë‹¤.
- Special ê²½ìš°:
  - rootê°€ leafê°€ ì•„ë‹ˆë©´, ìµœì†Œ 2ê°œì˜ childrenì„ ê°€ì§„ë‹¤.
  - rootê°€ leafì¸ ê²½ìš°(ì¦‰, íŠ¸ë¦¬ì— ë‹¤ë¥¸ ë…¸ë“œê°€ ì—†ìœ¼ë©´), 0ê°œì—ì„œ (nâ€“1)ê°œì˜ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

## $B^+$-Tree Node Structure
- ì¼ë°˜ì ì¸ ë…¸ë“œ <br>
  ![image](https://github.com/user-attachments/assets/5acda8ab-ed65-4546-8fb8-3d50b9116954) <br>
  - $K_i$ëŠ” search-key valuesì´ë‹¤.
  - $P_i$ëŠ” ìì‹ ë…¸ë“œë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°(non-leaf nodesì˜ ê²½ìš°)ì´ê±°ë‚˜ leaf nodeì—ì„œëŠ” ì‹¤ì œ ë°ì´í„°(buckets)ì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” pointersì´ë‹¤.
- ë…¸ë“œ ë‚´ì˜ ê²€ìƒ‰ í‚¤ë“¤ì€ $K_1 < K_2 < K_3 < \dots < K_{n-1}$ ìˆœì„œë¡œ ì •ë ¬ë˜ì–´ ìˆë‹¤. (ì´ˆê¸°ì—ëŠ” duplicate keysê°€ ì—†ë‹¤ê³  ê°€ì •í•˜ë©°, ì¤‘ë³µ í‚¤ëŠ” ë‚˜ì¤‘ì— ë‹¤ë£¬ë‹¤)

## Leaf Nodes in $B^+$-Trees
leaf nodeì˜ íŠ¹ì„±:
- $i = 1, 2, \dots, n-1$ì— ëŒ€í•´, pointer $P_i$ëŠ” search-key valueì´ $K_i$ì¸ file recordë¥¼ ê°€ë¦¬í‚¨ë‹¤.
- ë§Œì•½ $L_i$, $L_j$ê°€ leaf nodesì´ê³  $i < j$ë¼ë©´, $L_i$ì˜ ê²€ìƒ‰ í‚¤ ê°’ë“¤ì€ $L_j$ì˜ search-key valuesë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ë‹¤.
- $P_n$ì€ search-key orderì—ì„œ next leaf nodeë¥¼ ê°€ë¦¬í‚¨ë‹¤. <br>

![image](https://github.com/user-attachments/assets/2d675031-c2c2-4ac6-a2b1-03df5289e2ae)

## Non Leaf Nodes in $B^+$-Trees
- Non leaf nodesëŠ” leaf nodesì— ëŒ€í•œ multi-level(ë‹¤ë‹¨ê³„) sparse indexë¥¼ í˜•ì„±í•œë‹¤. <br>
  non-leaf nodeì— pointersê°€ mê°œ ìˆì„ ë•Œ:
  - $P_1$ì´ ê°€ë¦¬í‚¤ëŠ” ì„œë¸ŒíŠ¸ë¦¬ì˜ ëª¨ë“  ê²€ìƒ‰ í‚¤ ê°’ì€ $K_1$ë³´ë‹¤ ì‘ë‹¤.
  - $2 \leq i \leq n-1$ì¸ ê²½ìš°, $P_i$ê°€ ê°€ë¦¬í‚¤ëŠ” ì„œë¸ŒíŠ¸ë¦¬ì˜ ëª¨ë“  ê²€ìƒ‰ í‚¤ ê°’ì€ $K_{i-1}$ ì´ìƒì´ê³  $K_i$ ë¯¸ë§Œì´ë‹¤.
  - $P_n$ì´ ê°€ë¦¬í‚¤ëŠ” ì„œë¸ŒíŠ¸ë¦¬ì˜ ëª¨ë“  ê²€ìƒ‰ í‚¤ ê°’ì€ $K_{n-1}$ ì´ìƒì´ë‹¤. <br>

![image](https://github.com/user-attachments/assets/1a7dc67e-3f37-455a-b8c2-8ab6d92e9a8e)

## Example of $B^+$-tree
![image](https://github.com/user-attachments/assets/5d496260-bff2-41d7-9a71-a7c7c364b84b) <br>
instructor íŒŒì¼ì— ëŒ€í•œ $B^+$-íŠ¸ë¦¬ (n = 6)
- Leaf nodesì˜ ê°’ì´ $3$ê°œ ì´ìƒ $5$ê°œ ì´í•˜ì´ì–´ì•¼ í•œë‹¤ $\left( \lceil \frac{n - 1}{2} \rceil, n - 1\text{ì—ì„œ }n = 6 \right)$.
- rootë¥¼ ì œì™¸í•œ Non-leaf nodesëŠ” ìì‹ì´ $3$ê°œ ì´ìƒ $6$ê°œ ì´í•˜ì´ì–´ì•¼ í•œë‹¤ $\left( \lceil \frac{n}{2} \rceil, n\text{ì—ì„œ }n = 6 \right)$
- Root ìµœì†Œí•œ $2$ê°œì˜ childrenì„ ê°€ì ¸ì•¼ í•œë‹¤.

## Observations about $B^+$-trees 
- inter-node connectionsì€ pointersë¡œ ì´ë£¨ì–´ì§€ë¯€ë¡œ, "logically" ê°€ê¹Œìš´ ë¸”ë¡ë“¤ì´ "physically" ê°€ê¹Œìš¸ í•„ìš”ëŠ” ì—†ë‹¤.
- $B^+$-treeì˜ non-leaf levelsì€ hierarchy of sparse indices(í¬ì†Œ ì¸ë±ìŠ¤ì˜ ê³„ì¸µ êµ¬ì¡°)ë¥¼ ì´ë£¬ë‹¤.
- $B^+$-treeëŠ” ë¹„êµì  small number of levels(ì ì€ ìˆ˜ì˜ ë ˆë²¨)ì„ ê°€ì§„ë‹¤.
  - Level below root(ë£¨íŠ¸ ë°”ë¡œ ì•„ë˜ ë ˆë²¨)ì€ ìµœì†Œ $2 \times \lceil \frac{n}{2} \rceil$ ê°œì˜ ê°’ì„ ê°€ì§„ë‹¤. <br>
  rootì˜ ìì‹ì€ ìµœì†Œ 2ê°œì´ê³ , ìµœì†Œ âŒˆn/2âŒ‰ê°œì˜ ìì‹ì´ ìˆì–´ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ì´ê±¸ ë°˜ë³µì´ê¸° ë•Œë¬¸ì— nìŠ¹ì´ ëœë‹¤.
  - ê·¸ Next levelì€ ìµœì†Œ $2 \times \lceil \frac{n}{2} \rceil \times \lceil \frac{n}{2} \rceil$ ê°œì˜ ê°’ì„ ê°€ì§„ë‹¤.
  - â€¦ ë“±ë“±
  - fileì— search-key valuesì´ $K$ê°œ ìˆë‹¤ë©´, tree heightëŠ” ìµœëŒ€ $\lceil \log_{\lceil n/2 \rceil}(K) \rceil$ ì´ë‹¤.
  - ë”°ë¼ì„œ searchesëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìˆë‹¤.
- main fileì— ëŒ€í•œ Insertionsê³¼ deletionsëŠ” indexë¥¼ ë¡œê·¸ ì‹œê°„ ë‚´ì— ì¬êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

## Queries on $B^+$-Trees
- search-key value Vë¥¼ ê°€ì§„ recordë¥¼ ì°¾ëŠ”ë‹¤.
  1. $C = \text{root}$
  2. $C$ê°€ leaf nodeê°€ ì•„ë‹ ë™ì•ˆ {
     - $V \leq K_i$ë¥¼ ë§Œì¡±í•˜ëŠ” ìµœì†Œì˜ $i$ë¥¼ ì°¾ëŠ”ë‹¤.
     - ê·¸ëŸ° $i$ê°€ ì—†ë‹¤ë©´, $C$ë¥¼ $C$ì˜ ë§ˆì§€ë§‰ non-null pointerë¡œ ì„¤ì •í•œë‹¤.
     - Else { if (V = K_i) Set $C = P_{i+1}$ else C = p_i } <br>
â€ƒâ€ƒ }
  3. $K_i = V$ë¥¼ ë§Œì¡±í•˜ëŠ” ìµœì†Œì˜ $i$ë¥¼ ì°¾ëŠ”ë‹¤.
  4. ê·¸ëŸ° $i$ê°€ ìˆë‹¤ë©´, pointer $P_i$ë¥¼ ë”°ë¼ ì›í•˜ëŠ” recordë¡œ ì´ë™í•œë‹¤.
  5. ì—†ë‹¤ë©´, search-key value $V$ë¥¼ ê°€ì§„ recordëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. <br>

![image](https://github.com/user-attachments/assets/988bdccb-615f-4fa6-9fe1-dce9952b4efc) <br>
- fileì— search-key valuesì´ $K$ê°œ ìˆì„ ë•Œ, treeì˜ heightëŠ” ìµœëŒ€ $\lceil \log_{\lceil n/2 \rceil}(K) \rceil$ ì´ë‹¤.
- nodeëŠ” ì¼ë°˜ì ìœ¼ë¡œ disk blockê³¼ í¬ê¸°ê°€ ê°™ìœ¼ë©°, ë³´í†µ 4KBì´ë‹¤.
  - ê·¸ë¦¬ê³  $n$ì€ ë³´í†µ ì•½ 100ì´ë‹¤ (ì¸ë±ìŠ¤ í•­ëª©ë‹¹ 40ë°”ì´íŠ¸ ê¸°ì¤€).
- 100ê°œì˜ ë¶„ê¸° ìˆ˜($n=100$)ì™€ 100ë§Œ ê°œ(1 million)ì˜ ê²€ìƒ‰ í‚¤ ê°’(search key values)ì´ ìˆì„ ë•Œ
  - ì¡°íšŒ(lookup) ì‹œ ìµœëŒ€ $\log_{50}(1,000,000) = 4$ ë…¸ë“œê°€ ì ‘ê·¼ëœë‹¤. -> ìµœì•…ì˜ ê²½ìš° B/2 = 50ì´ì—¬ì„œ max 4ë²ˆì´ë‹¤.  
- 1ë°±ë§Œ(1 million) ê°œ ê²€ìƒ‰ í‚¤ ê°’ì„ ê°€ì§„ ê· í˜• ì´ì§„ íŠ¸ë¦¬(balanced binary tree)ì™€ ë¹„êµí•˜ë©´ -> <br>
  ì¡°íšŒ(lookup) ì‹œ ì•½ 20ê°œì˜ nodesê°€ ì ‘ê·¼ëœë‹¤.
  - ì´ differenceëŠ” ì¤‘ìš”í•˜ë‹¤. ì™œëƒí•˜ë©´ ê° node ì ‘ê·¼ë§ˆë‹¤ disk I/Oê°€ í•„ìš”í•  ìˆ˜ ìˆê³ , ì´ë¡œ ì¸í•´ ì•½ 20 millisecondsì˜ ë¹„ìš©ì´ ë“¤ê¸° ë•Œë¬¸ì´ë‹¤. <br>

![image](https://github.com/user-attachments/assets/7c618d02-cba3-49ba-9d8c-901e7713c12d) <br>
![image](https://github.com/user-attachments/assets/8b82d52c-2ee2-4a79-a6f7-67c2aece68d0) <br>
![image](https://github.com/user-attachments/assets/a2fb0c5b-307e-445e-bdf8-6b07c2aa1721) <br>
![image](https://github.com/user-attachments/assets/c9f09178-f44d-4d1f-a601-bc14c52b849b)

## Updates on $B^+$-Trees: Insertion
1. search-key valueì´ ë‚˜íƒ€ë‚  leaf nodeë¥¼ ì°¾ëŠ”ë‹¤.
2. search-key valueì´ leaf nodeì— ì´ë¯¸ ì¡´ì¬í•˜ë©´
   1. recordë¥¼ fileì— ì¶”ê°€í•œë‹¤.
   2. í•„ìš”í•˜ë‹¤ë©´ bucketì— ëŒ€í•œ pointerë¥¼ ì¶”ê°€í•œë‹¤.
      - ex) ì´ë¯¸ 'ê¹€ì² ìˆ˜'ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ë ˆì½”ë“œê°€ ìˆìœ¼ë©´, ê·¸ leaf nodeì— ìƒˆë¡œ ë“¤ì–´ì˜¨ 'ê¹€ì² ìˆ˜' ê°’(ì¦‰, ë˜ ë‹¤ë¥¸ 'ê¹€ì² ìˆ˜' ë ˆì½”ë“œ)ì„ ì¶”ê°€í•œë‹¤. <br>
  ê·¸ë¦¬ê³  ë§Œì•½ ê°™ì€ ì´ë¦„ì„ ê°€ì§„ ë ˆì½”ë“œê°€ ì—¬ëŸ¬ ê°œë¼ì„œ bucket(ì—¬ëŸ¬ ë ˆì½”ë“œë¥¼ ëª¨ì•„ë‘ëŠ” ê³µê°„)ì´ í•„ìš”í•˜ë‹¤ë©´, ê·¸ bucketì— ìƒˆ ë ˆì½”ë“œì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” pointerë„ ì¶”ê°€í•œë‹¤.
3. search-key valueì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´
   1. recordë¥¼ main fileì— ì¶”ê°€í•œë‹¤ (í•„ìš”í•˜ë‹¤ë©´ bucketë„ ìƒì„±).
   2. leaf nodeì— ê³µê°„(room)ì´ ìˆë‹¤ë©´, (key-value, pointer) ìŒì„ leaf nodeì— ì‚½ì…í•œë‹¤.
   3. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ìƒˆë¡œìš´ (key-value, pointer) í•­ëª©ê³¼ í•¨ê»˜ nodeë¥¼ splití•œë‹¤
- Splitting a leaf node:
  - ì‚½ì…í•  í•­ëª©ì„ í¬í•¨í•˜ì—¬ ì´ $n$ê°œì˜ (search-key value, pointer) ìŒì„ ì •ë ¬ëœ ìˆœì„œë¡œ ë‚˜ì—´í•œë‹¤. ì²˜ìŒ $âŒˆn/2âŒ‰$ê°œëŠ” ê¸°ì¡´ nodeì—, ë‚˜ë¨¸ì§€ëŠ” ìƒˆ nodeì— ë°°ì¹˜í•œë‹¤.
  - new nodeë¥¼ $p$, $p$ì—ì„œ ê°€ì¥ ì‘ì€ key valueì„ $k$ë¼ê³  í•˜ë©´, ë¶„í• ëœ ë…¸ë“œì˜ parent nodeì— $(k, p)$ë¥¼ ì‚½ì…í•œë‹¤.
  - parent nodeê°€ ê°€ë“ ì°¨ ìˆë‹¤ë©´, ê·¸ê²ƒë„ splití•˜ê³  ë¶„í• ì„ ìœ„ìª½ìœ¼ë¡œ ì „íŒŒí•œë‹¤.
- ë…¸ë“œ ë¶„í• ì€ ê°€ë“ ì°¨ì§€ ì•Šì€ ë…¸ë“œë¥¼ ë§Œë‚  ë•Œê¹Œì§€ ìœ„ë¡œ ê³„ì† ì§„í–‰ëœë‹¤.
  - worst case, root nodeê¹Œì§€ ë¶„í• ë˜ë©° height of theê°€ 1ë§Œí¼ ì¦ê°€í•  ìˆ˜ ìˆë‹¤. <br>

![image](https://github.com/user-attachments/assets/d0a8ad28-296f-4fc7-b407-4287f88b4412)

## $B^+$-Tree Insertion
![image](https://github.com/user-attachments/assets/058e45e9-a9f3-4221-92b2-a1c5dbe22532) <br>
![image](https://github.com/user-attachments/assets/94c94ce2-5e84-41a2-a59d-03fa71b7bd9c) <br>
ì—¬ê¸°ì„œ ë´ì•¼í•  1ê°€ì§€ íŠ¹ì´ì ì´ ìˆë‹¤. <br>
- Leaf Node Split vs Internal Node Splitì˜ ì°¨ì´
  - Lamportì˜ ê²½ìš° (Leaf Node Split): <br>
  LamportëŠ” leaf nodeì— ì‚½ì… -> split -> ìœ„ë¡œ ë³µì‚¬ -> ë”°ë¼ì„œ leaf + internal ë‘˜ë‹¤ ìˆë‹¤. <br> 
  ë‹¤ë§Œ í•´ë‹¹ nodeê°€ ê³„ì† ì˜¬ë¼ê°€ë©´ leaf + ìµœì¢… ë„ì°©í•œê³³ 2ê³³ì—ë§Œ ìˆë‹¤.
  - Goldì˜ ê²½ìš° (Internal Node Split): <br>
  GoldëŠ” Internal node splitì—ì„œëŠ” ì¤‘ê°„ key(Gold)ë¥¼ ë¶€ëª¨ë¡œ ì´ë™(push up/move up) í•œã„·. <br>
  ë”°ë¼ì„œ GoldëŠ” ì›ë˜ internal nodeì—ì„œ ì œê±°ë˜ê³  ìƒìœ„ ë…¸ë“œë¡œë§Œ ì˜¬ë¼ê°‘ë‹ˆë‹¤

## Insertion in $B^+$-Trees (Cont.)
- Splitting a non node N-leaf node: ì´ë¯¸ ê°€ë“ ì°¬ ë‚´ë¶€ ë…¸ë“œì— (k, p)ë¥¼ insertingí•  ë•Œ
  - Nì„ n+1ê°œì˜ í¬ì¸í„°ì™€ nê°œì˜ í‚¤ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ Mìœ¼ë¡œ ë³µì‚¬í•œë‹¤
  - (k, p)ë¥¼ Mì— ì‚½ì…í•œë‹¤
  - Mì—ì„œ $P_1$, $K_1$, â€¦, $K_{âŒˆn/2âŒ‰-1}$, $P_{âŒˆn/2âŒ‰}$ë¥¼ ë‹¤ì‹œ ë…¸ë“œ Nì— ë³µì‚¬í•œë‹¤
  - Mì—ì„œ $P_{âŒˆn/2âŒ‰+1}$, $K_{âŒˆn/2âŒ‰+1}$, â€¦, $K_n$, $P_{n+1}$ë¥¼ ìƒˆë¡œ í• ë‹¹ëœ ë…¸ë“œ Nâ€™ì— ë³µì‚¬í•œë‹¤
  - ($K_{âŒˆn/2âŒ‰}$, Nâ€™)ë¥¼ ë…¸ë“œ Nì˜ ë¶€ëª¨ì— ì‚½ì…í•œë‹¤ <br>
ìœ„ì—ì„œ ì„¤ëª…í•œ Internalê´€ë ¨ì´ë‹¤. <br>
![image](https://github.com/user-attachments/assets/a65b943d-3053-4b0d-b9c0-effcb8e5ba5a) <br>
![image](https://github.com/user-attachments/assets/649a4843-b016-448a-a18d-889de72090e7) <br>
![image](https://github.com/user-attachments/assets/4c55125d-52be-4b44-b96e-a2bcf9e9b786) <br>

## Examples of $B^+$-Tree Deletion -> deletionì€ ìì„¸íˆX êµ¬í˜„X ì–´ëŠì •ë„ ì´í•´ë§Œ í•´ë‘ì
![image](https://github.com/user-attachments/assets/7efcc047-1fa1-4173-97f2-b3a288d7f435) <br>
![image](https://github.com/user-attachments/assets/d664dbe1-c42a-4fc9-b334-a487b29e0168) <br>
- Singhì™€ Wuë¥¼ í¬í•¨í•˜ëŠ” leafê°€ ë¶€ì¡±í•´ì ¸ì„œ left sibling nodeì—ì„œ Kim ê°’ì„ ë¹Œë ¸ë‹¤
- ê·¸ ê²°ê³¼ ë¶€ëª¨ ë…¸ë“œì˜  Search-key valueì´ ë³€ê²½ëœë‹¤ <br>

![image](https://github.com/user-attachments/assets/f3a9112c-f73f-4141-bbba-c55fd18c5ae5) <br>
Goldì™€ Katzë¥¼ ê°€ì§„ ë…¸ë“œê°€ ë¶€ì¡±í•´ì ¸ì„œ sibling ë…¸ë“œì™€ mergedë˜ì—ˆë‹¤ <br>
Parent ë…¸ë“œë„ ë¶€ì¡±í•´ì ¸ì„œ Parentì˜ sibling ë…¸ë“œì™€ ë³‘í•©ë˜ì—ˆë‹¤ <br>
  ë‘ ë…¸ë“œë¥¼ êµ¬ë¶„í•˜ëŠ” Value(ë¶€ëª¨ ë…¸ë“œì— ìˆëŠ” ê°’)ì´ ë³‘í•©ë  ë•Œ ì•„ë˜ë¡œ ë‚´ë ¤ì˜¨ë‹¤ <br>
Root ë…¸ë“œëŠ” ìì‹ì´ í•˜ë‚˜ë§Œ ë‚¨ì•„ ì‚­ì œëœë‹¤

## Updates on $B^+$-Trees: Deletion
- ì‚­ì œí•  ë ˆì½”ë“œë¥¼ ì°¾ì•„ main fileê³¼ bucket(ìˆë‹¤ë©´)ì—ì„œ ì œê±°í•œë‹¤
- ë²„í‚·ì´ ì—†ê±°ë‚˜ ë²„í‚·ì´ ë¹„ì–´ ìˆìœ¼ë©´, leaf ë…¸ë“œì—ì„œ (search-key value, pointer)ë¥¼ ì œê±°í•œë‹¤
- ì œê±°ë¡œ ì¸í•´ ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ ë„ˆë¬´ ì ê³ , í•´ë‹¹ ë…¸ë“œì™€ í˜•ì œ ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ í•˜ë‚˜ì˜ ë…¸ë“œì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆìœ¼ë©´, í˜•ì œ ë…¸ë“œë¥¼ ë³‘í•©í•œë‹¤:
  - ë‘ ë…¸ë“œì˜ ëª¨ë“  search-key valuesì„ í•˜ë‚˜ì˜ ë…¸ë“œ(ì™¼ìª½ ë…¸ë“œ)ì— ì‚½ì…í•˜ê³ , ë‹¤ë¥¸ ë…¸ë“œëŠ” ì‚­ì œí•œë‹¤
  - ì‚­ì œëœ ë…¸ë“œë¥¼ ê°€ë¦¬í‚¤ëŠ” pointer $ğ‘ƒ_i$ì™€ ìŒì„ ì´ë£¨ëŠ” ($K_{iâˆ’1}$, $p_i$)ë¥¼ ë¶€ëª¨ ë…¸ë“œì—ì„œ ì‚­ì œí•˜ë©°, ìœ„ ì ˆì°¨ë¥¼ ì¬ê·€ì (recursively)ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤
- ë§Œì•½ ì‚­ì œë¡œ ì¸í•´ ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ ë„ˆë¬´ ì ì§€ë§Œ, í•´ë‹¹ ë…¸ë“œì™€ sibling ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ í•˜ë‚˜ì˜ ë…¸ë“œì— ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” pointersë¥¼ ì¬ë¶„ë°°(redistribute)í•œë‹¤:
  - ë…¸ë“œì™€ sibling ë…¸ë“œ ì‚¬ì´ì— pointersë¥¼ ì¬ë¶„ë°°í•˜ì—¬ ë‘ ë…¸ë“œ ëª¨ë‘ ìµœì†Œ ì—”íŠ¸ë¦¬ ìˆ˜ ì´ìƒì´ ë˜ë„ë¡ í•œë‹¤.
  - ë…¸ë“œì˜ ë¶€ëª¨ì— ìˆëŠ” ëŒ€ì‘(corresponding)í•˜ëŠ” search-key valueì„ ì—…ë°ì´íŠ¸í•œë‹¤.
- ë…¸ë“œ ì‚­ì œëŠ” ìœ„ë¡œ ì—°ì‡„ì (cascade)ìœ¼ë¡œ ì§„í–‰ë  ìˆ˜ ìˆìœ¼ë©°, í¬ì¸í„°ê°€ âŒˆn/2âŒ‰ê°œ ì´ìƒì¸ ë…¸ë“œê°€ ë°œê²¬ë  ë•Œê¹Œì§€ ê³„ì†ëœë‹¤.
- ì‚­ì œ í›„ ë£¨íŠ¸ ë…¸ë“œì— í¬ì¸í„°ê°€ í•˜ë‚˜ë§Œ ë‚¨ìœ¼ë©´, ë£¨íŠ¸ ë…¸ë“œë¥¼ ì‚­ì œí•˜ê³  ê·¸ ìœ ì¼í•œ ìì‹ ë…¸ë“œê°€ ìƒˆë¡œìš´ ë£¨íŠ¸ê°€ ëœë‹¤. -> root node ì‚­ì œ -> levelì´ 1ê°œ down <br>

![image](https://github.com/user-attachments/assets/ed58d4b9-7871-44c8-9169-9dba5e1acae8)

## $B^+$-Tree File Organization
- Index fileì˜ ì—´í™”(degradation) ë¬¸ì œëŠ” $B^+$-Tree indicesë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í•´ê²°ëœë‹¤.
- Data fileì˜ ì—´í™”(degradation) ë¬¸ì œëŠ” B ì¡°ì§(B Organization)ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í•´ê²°ëœë‹¤.
- $B^+$-tree file organizationì—ì„œëŠ” leaf ë…¸ë“œê°€ í¬ì¸í„° ëŒ€ì‹  ì‹¤ì œ ë ˆì½”ë“œë¥¼ ì €ì¥í•œë‹¤.
- leaf ë…¸ë“œëŠ” ì—¬ì „íˆ ì ˆë°˜ ì´ìƒ ì°¨ ìˆì–´ì•¼ í•œë‹¤.
  - recordsëŠ” pointersë³´ë‹¤ í¬ê¸° ë•Œë¬¸ì—, leaf ë…¸ë“œì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ë ˆì½”ë“œ ìˆ˜ëŠ” nonleaf nodeì— ì €ì¥í•  ìˆ˜ ìˆëŠ” í¬ì¸í„° ìˆ˜ë³´ë‹¤ ì ë‹¤.
- Insertionê³¼ deletionëŠ” $B^+$-tree indexì—ì„œì˜ ì‚½ì… ë° ì‚­ì œ ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ëœë‹¤.<br>

![image](https://github.com/user-attachments/assets/2a5cf496-d0b0-4baa-b625-8ed2c1bab730)
- recordsëŠ” pointersë³´ë‹¤ ë” ë§ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë¯€ë¡œ, ì¢‹ì€ space utilizationì´ ì¤‘ìš”í•˜ë‹¤.
- space utilizationë¥¼ ë†’ì´ê¸° ìœ„í•´, ë¶„í• (split) ë° ë³‘í•©(merge) ì‹œ ë” ë§ì€ sibling ë…¸ë“œë¥¼ ì¬ë¶„ë°°ì— ì°¸ì—¬ì‹œí‚¨ë‹¤.
  - ê°€ëŠ¥í•œ ë¶„í• /ë³‘í•©ì„ í”¼í•˜ê¸° ìœ„í•´ í˜•ì œ ë…¸ë“œ 2ê°œë¥¼ ì¬ë¶„ë°°ì— í¬í•¨ì‹œí‚¤ë©´, ê° ë…¸ë“œëŠ” ìµœì†Œ âŒŠ2n/3âŒ‹ê°œì˜ ì—”íŠ¸ë¦¬ë¥¼ ê°–ê²Œ ëœë‹¤. <br>
![image](https://github.com/user-attachments/assets/9eafbf99-8230-4198-9df8-5647fcfe0ff0)

## Other Issues in Indexing
- Record ì¬ë°°ì¹˜(relocation)ì™€ secondary indices
  - ë ˆì½”ë“œê°€ ì´ë™í•˜ë©´, ë ˆì½”ë“œ í¬ì¸í„°ë¥¼ ì €ì¥í•˜ëŠ” ëª¨ë“  secondary indicesë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•œë‹¤.
  - $B^+$-tree file organizationsì—ì„œì˜ ë…¸ë“œ ë¶„í• ì€ ë§¤ìš° ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤. -> ìœ„ì˜ ì´ìœ ë•Œë¬¸
  - Solution: secondary indexì— ë ˆì½”ë“œ í¬ì¸í„° ëŒ€ì‹  ê¸°ë³¸ ì¸ë±ìŠ¤ ê²€ìƒ‰ í‚¤(primary-index search key)ë¥¼ ì‚¬ìš©í•œë‹¤.
  - ë ˆì½”ë“œë¥¼ ì°¾ê¸° ìœ„í•´ ê¸°ë³¸ ì¸ë±ìŠ¤(primary index)ë¥¼ ì¶”ê°€ë¡œ íƒìƒ‰(traversal)í•´ì•¼ í•˜ë¯€ë¡œ ì¿¼ë¦¬(queries) ë¹„ìš©ì€ ì¦ê°€í•˜ì§€ë§Œ, ë…¸ë“œ splitsì€ ì €ë ´í•´ì§„ë‹¤.
  - ê¸°ë³¸ ì¸ë±ìŠ¤ ê²€ìƒ‰ í‚¤(primary-index search key)ê°€ ìœ ì¼í•˜ì§€ ì•Šë‹¤ë©´ ë ˆì½”ë“œ ID(record-id)ë¥¼ ì¶”ê°€í•œë‹¤.<br>

![image](https://github.com/user-attachments/assets/ce17924e-5e08-4849-a731-fb9f967a0861)

## B-Tree Index Files
![image](https://github.com/user-attachments/assets/3b733aaf-afc5-499c-ab60-e4b6fb6649fc) <br>
- $B^+$-treeì™€ ìœ ì‚¬í•˜ì§€ë§Œ, B-treeëŠ” search-key valuesë¥¼ í•œ ë²ˆë§Œ ë‚˜íƒ€ë‚˜ë„ë¡ í•˜ì—¬ search keysì˜ redudant(ì¤‘ë³µ) ì €ì¥ì„ ì œê±°í•œë‹¤. <br>
- B-treeì˜ nonleaf nodesì— ìˆëŠ” search keyëŠ” treeì˜ ë‹¤ë¥¸ ê³³ì— ë‚˜íƒ€ë‚˜ì§€ ì•Šìœ¼ë©°, <br>
  nonleaf nodeì˜ ê° search keyë§ˆë‹¤ ì¶”ê°€ì ì¸ pointer fieldê°€ í¬í•¨ë˜ì–´ì•¼ í•œë‹¤. <br>
  -> ì¦‰, pointerê°€ 2ê°œì´ë‹¤. 1ê°œëŠ” $B+^$-treeì²˜ëŸ¼ ë‹¤ë¥¸ ê³³ ê°€ë¦¬í‚¤ëŠ” pointerì´ê³ , ë‹¤ë¥¸ í•˜ë‚˜ëŠ” ë³¸ì¸ì˜ valueë¥¼ ê°€ë¦¬í‚¤ëŠ” ê±°ì´ë‹¤. 
- ì¼ë°˜í™”ëœ B-tree leaf node (a) <br>
  ![image](https://github.com/user-attachments/assets/fce47089-7601-43b1-b884-5ef2020107a6) <br>
- nonleaf node (b) â€“ pointer $B_i$ëŠ” bucket ë˜ëŠ” file record pointerì´ë‹¤. <br>
![image](https://github.com/user-attachments/assets/2731bddf-b0fb-45d9-8e19-707a19b6bb9b)

## B-Tree Index File Example
![image](https://github.com/user-attachments/assets/c9ee50b2-78d4-42f3-8c70-12a9df58c09d) <br>
- Advantages of B-Tree indices:
  - Bâº-treeë³´ë‹¤ ë” ì ì€ íŠ¸ë¦¬ ë…¸ë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.(ì¤‘ë³µì´ ì œê±° ë˜ì–´ìˆê¸° ë•Œë¬¸ì´ë‹¤)
  - leaf nodeì— ë„ë‹¬í•˜ê¸° ì „ì— search-key valueì„ ì°¾ì„ ìˆ˜ ìˆëŠ” ê²½ìš°ê°€ ìˆë‹¤. ì¦‰, root -> leafê°€ ì•„ë‹ˆì—¬ë„ ì°¾ì„ ìˆ˜ ìˆë‹¤.
- Disadvantages of B-Tree indices:
  - ê²€ìƒ‰ í‚¤ê°€ ì•„ë‹Œ ê°’ ì¤‘ ë‹¨ë§ ë…¸ë“œ ì´ì „ì— ë°œê²¬ë˜ëŠ” ë¹„ìœ¨ì´ ì ìŒ â€” leaf nodesê°€ ë” í¬ë¯€ë¡œ íŒŒë…¸ë¼ë§ˆ ê³„ìˆ˜(fan-out)ê°€ ì¤„ì–´ë“ ë‹¤. <br>
  ë”°ë¼ì„œ B-treeëŠ” ì¼ë°˜ì ìœ¼ë¡œ ëŒ€ì‘í•˜ëŠ” Bâº-treeë³´ë‹¤ ë” ê¹Šë‹¤.
  - Insertionê³¼ deletionì€ Bâº-treeë³´ë‹¤ ë” ë³µì¡í•˜ë‹¤.
  - Implementationì´ Bâº-treeë³´ë‹¤ ë” ì–´ë µë‹¤.
- ì¼ë°˜ì ìœ¼ë¡œ, B-treeì˜ ì¥ì ì€ ë‹¨ì ì„ ìƒì‡„í•˜ì§€ ëª»í•œë‹¤.

## Multiple-Key Access
- certain types of queriesì— ëŒ€í•´ multiple indicesë¥¼ ì‚¬ìš©í•œë‹¤.
- Example:
  ```SQL
  select ID
  from instructor
  where dept_name = â€œFinanceâ€ and salary = 80000 // ì´ëŸ°ì‹ìœ¼ë¡œ multiple-keyì¼ ë•Œ
  ```
- single attributesì— ëŒ€í•œ indicesë¥¼ í™œìš©í•œ ì²˜ë¦¬ ì „ëµ 3ê°€ì§€:
  1. dept_name indexë¥¼ ì‚¬ìš©í•´ í•™ê³¼ëª…ì´ "Finance"ì¸ ê°•ì‚¬ë¥¼ ì°¾ê³ , salary = 80000ì¸ì§€ ê²€ì‚¬
  2. salary indexë¥¼ ì‚¬ìš©í•´ ê¸‰ì—¬ê°€ 80000ì¸ ê°•ì‚¬ë¥¼ ì°¾ê³ , dept_name = â€œFinanceâ€ì¸ì§€ ê²€ì‚¬
  3. dept_name indexë¥¼ ì‚¬ìš©í•´ "Finance" í•™ê³¼ì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  record pointerë¥¼ ì°¾ê³ , salary indexë„ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•œ í›„ ë‘ í¬ì¸í„° ì§‘í•©ì˜ intersectionì„ êµ¬í•œë‹¤.

## Indices on Multiple Keys
- Composite search keys are search keys containing more than one attribute
  - E.g. (dept_name, salary) -> ê°™ì´ ì‚¬ìš©í•˜ëŠ” search key ì°¾ëŠ”ë‹¤.
- Lexicographic ordering: ($a_1$, $a_2$) < ($b_1$, $b_2$) if either
  - $a_1$ < $b_1$, or -> dept_name ë¨¼ì €
  - $a_1=b_1$ and  $a_2 < b_2$ -> ì•„ë‹Œê²½ìš° salaryë¡œ ì²˜ë¦¬
  - (cs,80000) (cs,90000) (EE, 100000) ,.... ì´ëŸ°ì‹ìœ¼ë¡œ indexë¥¼ ë§Œë“ ë‹¤.
 
## Indices on Multiple Attributes
(dept_name, salary) combined search-keyì— ëŒ€í•œ indexê°€ ìˆë‹¤ê³  ê°€ì •í•œë‹¤.
- With the where clause
  ```SQL
  where dept_name = â€œFinanceâ€ and salary = 80000
  ```
(dept_name, salary) ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë‘ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” ë ˆì½”ë“œë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤(fetch)
  - ê°œë³„ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ê²½ìš° íš¨ìœ¨ì´ ë–¨ì–´ì§ <br>
  -> í•œ ì¡°ê±´ë§Œ ë§Œì¡±í•˜ëŠ” records(ë˜ëŠ” pointers)ë¥¼ ë§ì´ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤(fetch)
- ë‹¤ìŒê³¼ ê°™ì€ ì§ˆì˜ë„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥:
  ```SQL
  where dept_name = â€œFinanceâ€ and salary < 80000
  ``` 
- í•˜ì§€ë§Œ ì•„ë˜ ì§ˆì˜ëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ ëª»í•œë‹¤:
  ```SQL
  wheredept_name < â€œFinanceâ€ and balance = 80000
  ```
ì˜ ì‘ë™í•˜ì§€ ëª»í•˜ëŠ” ì´ìœ ëŠ” ë³µí•© ì¸ë±ìŠ¤ê°€ (dept_name, salary) ìˆœìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤. <br>
ì´ ì¿¼ë¦¬ëŠ” dept_nameì— ë²”ìœ„ ì¡°ê±´(< "Finance")ì„ ì£¼ê³ , salaryì—ëŠ” ì •í™•í•œ ê°’ì„ ì£¼ëŠ”ë°, <br>
salaryëŠ” dept_name ê·¸ë£¹ ë‚´ë¶€ì—ì„œë§Œ ì •ë ¬ë˜ì–´ ìˆì–´ì„œ, ì „ì²´ ë²”ìœ„ì— ëŒ€í•´ salary ì¡°ê±´ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì ìš©í•˜ê¸° ì–´ë µë‹¤.
- ì²« ë²ˆì§¸ ì¡°ê±´ë§Œ ë§Œì¡±í•˜ëŠ” ë ˆì½”ë“œë¥¼ ë§ì´ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. (ë‘ ë²ˆì§¸ ì¡°ê±´ê³¼ëŠ” ë¬´ê´€)
