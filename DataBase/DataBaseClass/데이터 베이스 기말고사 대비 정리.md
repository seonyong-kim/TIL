# 6. Relational DB Design
## F+ ê³„ì‚°ì ˆì°¨
```
 Fâº = F
 repeat
   for each functional dependency f in Fâº
     apply reflexivity and augmentation rules on f
     add the resulting functional dependencies to Fâº
   for each pair of functional dependencies f1 and f2 in Fâº
     if f1 and f2 can be combined using transitivity
       then add the resulting functional dependency to Fâº
 until F + does not change any further
```
reflexivity(ë°˜ì‚¬ì„±)ì™€ augmentation(ì¦ê°•)ì„ fì— ì ìš©í•´ ë” ë§ì€ functional dependenciesë¥¼ ì ìš©í•˜ê³  ë‚˜ì˜¨ ê²°ê³¼ë¥¼ $F^+$ì— ì¶”ê°€í•œë‹¤.<br>
$F^+$ì•ˆì— ìˆëŠ” ë‘ ìŒì— ëŒ€í•´ transitivityê°€ ê°€ëŠ¥í•œì§€ í™•ì¸í•˜ê³  ê°€ëŠ¥í•˜ë©´ ê²°ê³¼ë¥¼ $F^+$ì— ì¶”ê°€í•œë‹¤.<br>
ìµœì•…ì˜ ê²½ìš° O($2^n$) ì˜ Fê°œìˆ˜ ë§Œí¼
- Reflexivity: A â†’ A (ìê¸° ìì‹ ì„ í•¨ìˆ˜ë¡œ)  /  Augmentation: ì–‘ìª½ì— ê°™ì€ ì†ì„± ì¶”ê°€ A â†’ Bì´ë©´ AC â†’ BC

## Closure of Functional Dependencies
- Î± â†’ Î²ì´ê³ , Î± â†’ Î³ë¼ë©´, Î± â†’ Î²Î³ë„ ì„±ë¦½í•œë‹¤ (union)
- Î± â†’ Î²Î³ê°€ ì„±ë¦½í•˜ë©´, Î± â†’ Î²ë„ ì„±ë¦½í•˜ê³  Î± â†’ Î³ë„ ì„±ë¦½í•œë‹¤ (decomposition)
- Î± â†’ Î²ì´ê³ , Î³Î² â†’ Î´ë¼ë©´, Î±Î³ â†’ Î´ë„ ì„±ë¦½í•œë‹¤ (pseudotransitivity)

## Closure of Attribute Sets
- set of attributes(ì†ì„± ì§‘í•©) Î±ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, Fì— ëŒ€í•œ closure of Î±(Î±âº)ë¥¼, Fì— ì˜í•´ Î±ë¡œë¶€í„° í•¨ìˆ˜ì ìœ¼ë¡œ ê²°ì •ë˜ëŠ” ì†ì„±ë“¤ì˜ ì§‘í•©ìœ¼ë¡œ ì •ì˜í•œë‹¤.
``` 
result := Î±;
 while (changes to result) do
 for each Î² â†’ Î³ in F do
 begin
 if Î² âŠ† result then result := result âˆª Î³
end
```
Î± â†’ result ì´ê³  Î² â†’ Î³ ì¼ë•Œ ifë¶€ë¶„ ë§Œì¡±ì‹œ result â†’ Î² ì´ë¯€ë¡œ Î± â†’ Î³ ì´ë‹¤.

### Example of Attribute Set Closure
- R = (A, B, C, G, H, I)  /  F = {A â†’ B, A â†’ C, CG â†’ H, CG â†’ I, B â†’ H}
- $(AG)^+$ ì£¼ì–´ì§„ í•¨ìˆ˜ì  ì¢…ì†ì„± ì§‘í•© F ì•„ë˜ì—ì„œ (AG)âºë¥¼ ê³„ì‚°í•œ ê²°ê³¼:
1. result = AG
2. A â†’ B, A â†’ C ì‚¬ìš© â†’ result = ABCG
3. CG â†’ H ì‚¬ìš© ê°€ëŠ¥ (CG âŠ† ABCG) â†’ result = ABCGH
4. CG â†’ I ì‚¬ìš© ê°€ëŠ¥ (CG âŠ† ABCGH) â†’ result = ABCGHI <br>
ìµœì¢…ì ìœ¼ë¡œ (AG)âº = {A, B, C, G, H, I} AGì—ì„œ ëª¨ë“ ê²ƒìœ¼ë¡œ ê°ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ superkeyì´ë‹¤.
- AGëŠ” cadidate keyì¸ê°€?
  - $A^+$ì— ëŒ€í•´
  1. result = $A^+$
  2. result = ABC
  3. result = ABCH -> AëŠ” keyX
  - $G^+$ì— ëŒ€í•´
  1. result = G -> Gë„ keyX <br>
ë”°ë¼ì„œ $AG^+$ëŠ” cadidate keyì´ë‹¤.

## Uses of Attribute Closure
there are several uses of the attribute closure algorithm:
- Testing for Superkey:<br>
  Î±ê°€ ìŠˆí¼í‚¤ì¸ì§€ í™•ì¸í•˜ë ¤ë©´, Î±âºë¥¼ ê³„ì‚°í•˜ê³  R(ë¦´ë ˆì´ì…˜ì˜ ëª¨ë“  ì†ì„±)ì„ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸í•œë‹¤.
- Testing Functional Dependencies:<br>
  í•¨ìˆ˜ì  ì¢…ì†ì„± Î± â†’ Î²ê°€ ì„±ë¦½í•˜ëŠ”ì§€(Fâºì— í¬í•¨ë˜ëŠ”ì§€) í™•ì¸í•˜ë ¤ë©´, Î±âºë¥¼ êµ¬í•´ì„œ Î²ê°€ ê·¸ ì•ˆì— í¬í•¨ë˜ëŠ”ì§€ í™•ì¸í•˜ë©´ ëœë‹¤. 
- Computing Closure of F (Fâº êµ¬í•˜ê¸°) :<br>
  $F^+$ë¥¼ ë‹¤ êµ¬í•´ì„œ Unionì„ í†µí•´ êµ¬í•  ìˆ˜ ìˆë‹¤.

## Lossless-join Decomposition
- R = (Râ‚, Râ‚‚)ë¡œ ìª¼ê°  í›„,  ê°ê° ìª¼ê° ê²ƒì„ joiní•˜ë©´ Rë¡œ ì›ìƒë³µêµ¬ ê°€ëŠ¥
- Rì„ Râ‚ê³¼ Râ‚‚ë¡œ decompositioní•œ ê²ƒì´ lossless joinì´ ë˜ë ¤ë©´, ë‹¤ìŒ ì¢…ì†ì„±ë“¤ ì¤‘ ì ì–´ë„ í•˜ë‚˜ê°€ Fâºì— í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤:
  - Râ‚ âˆ© Râ‚‚ â†’ Râ‚
  - Râ‚ âˆ© Râ‚‚ â†’ Râ‚‚ <br>

ë”°ë¼ì„œ, Râ‚ê³¼ Râ‚‚ì˜ êµì§‘í•©ì´ Râ‚ ë˜ëŠ” Râ‚‚ ì¤‘ ì ì–´ë„ í•˜ë‚˜ì˜ ìŠˆí¼í‚¤(superkey)ë¥¼ ì´ë£¨ë©´, Rì˜ decompositionëŠ” lossless decompositionì´ë‹¤.
- ì°¸ê³ ì‚¬í•­ : <br>
  R = (A,B,C) -> attribute ì§‘í•© / r(A,B,C) -> relation

### Example
- R = (A, B, C) <br>
F = {A â†’ B, B â†’ C) Aê°€ keyì´ë‹¤. <br>

2ê°€ì§€ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ìª¼ê°¤ ìˆ˜ ìˆë‹¤.
1. R1 = (A, B),   R2 = (B, C)
- Lossless-join decomposition : R1 âˆ© R2 = {B} and B â†’ BC ì´ë¯€ë¡œ R1 âˆ© R2 = R2(={BC})ì´ë‹¤. <br>
ë”°ë¼ì„œ Dependency preserving
2. R1 = (A, B),   R2 = (A, C)
- Lossless-join decomposition : R1 âˆ© R2 = {A} and A â†’ AB R1 âˆ© R2 = R1(={AB})ì´ë‹¤. <br>
í•˜ì§€ë§Œ Not dependency preserving B -> Cë¥¼ ë°”ë¡œ í™•ì¸ ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸

## Dependency Preservation
Fáµ¢ëŠ” Fâºì¤‘ì—ì„œ Ráµ¢ì— í¬í•¨ëœ attributesë§Œ ì‚¬ìš©í•˜ëŠ” set of dependenciesì´ë‹¤.
- ë‹¤ìŒ ì¡°ê±´ì´ ë§Œì¡±ë˜ë©´ ê·¸ ë¶„í•´ëŠ” í•¨ìˆ˜ì  ì¢…ì†ì„± ë³´ì¡´(dependency preserving)ì´ë¼ í•œë‹¤: <br>
(Fâ‚ âˆª Fâ‚‚ âˆª â€¦ âˆª Fâ‚™)âº = Fâº
- ì´ ì¡°ê±´ì´ ë§Œì¡±ë˜ì§€ ì•Šìœ¼ë©´, í•¨ìˆ˜ì  ì¢…ì†ì„± ìœ„ë°˜ ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ë ¤ë©´ relationë“¤ì„ joiní•´ì•¼ í•˜ë©°, ì´ëŠ” ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤.

### Example
- R = (A, B, C),  F = {A â†’ B, B â†’C} -> Key = {A} <br>
R is not in BCNF : BëŠ” í›„ë³´ í‚¤ê°€ ì•„ë‹Œë° ê²°ì •ìì—¬ì„œ -> BCNF ìœ„ë°˜
- Decomposition R1 = (A, B),  R2 = (B, C) <br>
R1 and R2 in BCNF <br>
Lossless-join decomposition: ë¶„í•´í•œ $R_1$ê³¼ $ğ‘…_2$ ë¥¼ ë‹¤ì‹œ ê²°í•©í•´ë„ ì›ë˜ì˜ ğ‘…ì„ ì™„ì „íˆ ë³µì›í•  ìˆ˜ ìˆë‹¤.<br>
Dependency preserving: ì›ë˜ ë¦´ë ˆì´ì…˜ì—ì„œì˜ ëª¨ë“  í•¨ìˆ˜ ì¢…ì†ì„±ì„ ë¶„í•´ í›„ì—ë„ ê°ê°ì˜ ë¶„í•´ ë¦´ë ˆì´ì…˜ì—ì„œ ê·¸ëŒ€ë¡œ í‘œí˜„í•  ìˆ˜ ìˆë‹¤.

## BCNF and Dependency Preservation
í•­ìƒ BCNF decompositionê°€ Dependency Preservationì„ ë§Œì¡±í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
- R = (J, K, L) / F = {JK â†’ L, L â†’ K}  candidate keyëŠ” JKì™€ JL ë‘ ê°œ <br>
Rì€ BCNFë¥¼ ë§Œì¡±í•˜ì§€ ì•ŠëŠ”ë‹¤ <br>
- ì´ìœ  : L â†’ KëŠ” BCNF ìœ„ë°˜ (Lì€ ìŠˆí¼í‚¤ê°€ ì•„ë‹˜, non trivaial) <br>
ë‹¨, këŠ” cadidate keyì˜ ì¼ë¶€ì´ë¯€ë¡œ 3NF ê°€ëŠ¥ -> ë”°ë¼ì„œ decomposeí•  í•„ìš”ê°€ ì—†ë‹¤.

## Comparison of BCNF and 3NF
- 3NFì˜ ê²½ìš°:
  - í•­ìƒ ì–´ë–¤ ë¦´ë ˆì´ì…˜ì´ë“  3NFë¡œ ë¶„í•´í•  ìˆ˜ ìˆë‹¤.
  - decomposition losslessê°€ ê°€ëŠ¥í•˜ê³ 
  - ëª¨ë“  dependencies preserved í•  ìˆ˜ ìˆë‹¤.
- BCNFì˜ ê²½ìš°:
  - ëª¨ë“  ë¦´ë ˆì´ì…˜ì„ BCNFë¡œ ë¶„í•´í•˜ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ì§€ë§Œ
  - decomposition losslessëŠ” ê°€ëŠ¥í•´ë„
  - preserve dependenciesê°€ í•­ìƒ ê°€ëŠ¥í•œ ê²ƒì€ ì•„ë‹ˆë‹¤

## Design Goals
- Goal for a relational database design is:
  - BCNF  /  Lossless join  /  Dependency preservation
- If we cannot achieve this, we accept one of(í•˜ë‚˜ë§Œ ì„ íƒ)
  - Lack of dependency preservation
  - Redundancy due to use of 3NF
-SQLì€ ìŠˆí¼í‚¤(superkey) ì´ì™¸ì˜ ë‹¤ë¥¸ í•¨ìˆ˜ì  ì¢…ì†ì„±ì„ ì§ì ‘ì ìœ¼ë¡œ ëª…ì‹œí•˜ëŠ” ë°©ë²•ì„ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤.<br>
í•¨ìˆ˜ì  ì¢…ì†ì„±(FD)ì€ ASSERTIONì„ ì‚¬ìš©í•´ì„œ ëª…ì‹œí•  ìˆ˜ ìˆì§€ë§Œ, í…ŒìŠ¤íŠ¸ ë¹„ìš©ì´ ë§¤ìš° í¬ë©°, í˜„ì¬ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œë“¤ì—ì„œëŠ” ì§€ì›ë˜ì§€ ì•ŠëŠ”ë‹¤!
- dependency preserving ë¶„í•´ë¥¼ í–ˆë”ë¼ë„,
SQLì—ì„œëŠ” ì¢Œë³€ì´ í‚¤ê°€ ì•„ë‹Œ í•¨ìˆ˜ì  ì¢…ì†ì„±ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê²€ì‚¬í•  ìˆ˜ ì—†ë‹¤. <br>
ë”°ë¼ì„œ BCNFë¡œ ìª¼ê°œëŠ”ê²Œ ë” ì¢‹ë‹¤.

----------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------------------------------------------------------------------

# 7. Storage and File Structures
## ë¬¼ë¦¬ì  ì €ì¥ ë§¤ì²´
- Cache: ê°€ì¥ ë¹ ë¥´ê³  ê°€ì¥ ë¹„ì‹¼ í˜•íƒœì˜ storage
  - íœ˜ë°œì„±, HWê°€ ê´€ë¦¬, ì ‘ê·¼ ì‹œê°„: a few nanoseconds ( $10^{-9}$ seconds)
- Main memory (RAM)
  - íœ˜ë°œì„±, ì ‘ê·¼ ì‹œê°„: a few hundreds nanoseconds ( $10^{-7}$ seconds)
- Flash memory
  â€“ ë¹„íœ˜ë°œì„±, ì ‘ê·¼ ì‹œê°„: under a hundred microseconds ( $10^{-4}$ ~ $10^{-5}$ seconds)
- Magnetic-disk
  - ë¹„íœ˜ë°œì„±, ì ‘ê·¼ì‹œê°„: a few milliseconds ( $10^{-3}$ seconds)
  - ë°ì´í„°ë¥¼ ì ‘ê·¼í•˜ë ¤ë©´ ë””ìŠ¤í¬ì—ì„œ ë©”ì¸ ë©”ëª¨ë¦¬ë¡œ ì˜®ê²¨ì•¼ í•˜ë©°, ì €ì¥í•˜ë ¤ë©´ ë‹¤ì‹œ ë””ìŠ¤í¬ì— ì¨ì•¼ í•œë‹¤.

## File Organization
- The database -> ê° filesë“¤ì˜ ëª¨ìŒ / ê° file -> recordsë“¤ì˜ ìˆœì„œë¡œ êµ¬ì„± / record -> fieldsë“¤ì˜ ìˆœì„œë¡œ êµ¬ì„±
  - ê° fileì€ fixed-length storage unitsì¸ blocksìœ¼ë¡œ ë¶„í•  (blockì€ ì €ì¥ í• ë‹¹ê³¼ ë°ì´í„° ì „ì†¡ì˜ ë‹¨ìœ„ì´ê³ , í•˜ë‚˜ì˜ blockì— ì—¬ëŸ¬ record ê°€ëŠ¥)
- Each fileì€ í•œ ê°€ì§€ ìœ í˜•ì˜ recordsë§Œ í¬í•¨í•˜ê³ , ë‹¤ë¥¸ relationsëŠ” ë‹¤ë¥¸ filesì— ì €ì¥ëœë‹¤.
- records 2ê°€ì§€ ìœ í˜•
  - Fixed-length records(ê³ ì • ê¸¸ì´ ë ˆì½”ë“œ)
  - Variable-length records(ê°€ë³€ ê¸¸ì´ ë ˆì½”ë“œ)
   
## External-Memory Model
- EM Modelì€ RAM (main memory) modelê³¼ ë‹¤ë¥´ë‹¤.
  - Time Complexity in RAM model: O(#basic operations) (e.g., memory access)
  - I/O Complexity in EM model: I/O: O(#I/Oâ€™s (read and write)) <br>
 Linear I/O: O( $N \over B$ ) < O(N)
- ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” í‘œê¸°
  - N: data fileì— ìˆëŠ” recordì˜ ìˆ˜
  - M: main memoryì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” recordì˜ ìˆ˜
  - B: í•˜ë‚˜ì˜ blockì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” recordì˜ ìˆ˜

## Fixed-Length Records
 ID            char(5),       -> 5 bytes <br>
 name          varchar(20),   -> 20 bytes at most <br>
 dept_name     varchar(20),   -> 20 bytes at most <br>
 salary        numeric(8,2),  -> 8 bytes <br>
ì´ 53byte fixed lengthì´ë‹¤.
- Simple approach:
  - ê° record iëŠ” byte n * (iâ€“ 1)ìœ„ì¹˜ ë¶€í„° ì €ì¥í•˜ê¸° ì‹œì‘í•œë‹¤. (nì€ recordì˜ í¬ê¸°ì´ë‹¤)
  - Record ì ‘ê·¼ì€ ê°„ë‹¨í•˜ì§€ë§Œ, recordsê°€ block boundariesë„˜ì§€ ì•Šê²Œ ê°€ì •ì„ í•´ì•¼í•œë‹¤.
- record i ì‚­ì œ:
  - (ë‹¨ìˆœí•œ ë°©ë²•): i+1 ë¶€í„° nê¹Œì§€ ëª¨ë“  ë ˆì½”ë“œë¥¼ ië¶€í„° n-1ê¹Œì§€ ì•ìœ¼ë¡œ ì´ë™í•œë‹¤. <br>
  ë°‘ì—ê±° ë¶€í„° ì±„ìš°ê³ , ì±„ì›Œì§€ë©´ ì œìë¦¬ë¡œê°„ë‹¤. ì´ëŸ°ì‹ìœ¼ë¡œ ì „ë¶€ ì§„í–‰í•˜ë©´ì„œ ì±„ìš´ë‹¤. -> O( $N \over B$ )I/O
  - (ê°œì„  ë°©ë²•): record nì„ ië¡œ ì´ë™ì‹œí‚¨ í›„ ì‚­ì œí•œë‹¤. <br>

![image](https://github.com/user-attachments/assets/6c2b322a-df9f-4093-8feb-502f308053b2)

## Maintaining Free Lists(ì‚­ì œì‹œ ì±„ìš°ê¸°ë³´ë‹¤ëŠ” ê·¸ëƒ¥ ë¹„ì›Œë‘ëŠ” ë°©ë²•)
- file headerì— ì²« ë²ˆì§¸ë¡œ ì‚­ì œëœ recordì˜ ì£¼ì†Œë¥¼ ì €ì¥í•œë‹¤.
- ì´ first recordì— second deleted recordì˜ ì£¼ì†Œë¥¼ ì €ì¥, ì´ëŸ°ì‹ìœ¼ë¡œ ê³„ì† ì—°ê²°í•œë‹¤.
- ì´ëŸ¬í•œ stored addressesë¥¼ pointersë¡œ ìƒê°í•  ìˆ˜ ìˆëŠ”ë°, ì´ëŠ” recordì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ê¸° ë•Œë¬¸ì´ë‹¤<br>
![image](https://github.com/user-attachments/assets/d9807fd0-8488-4780-bd98-ed3acdea0089) 
![image](https://github.com/user-attachments/assets/c8916881-42bd-45a8-9fa3-d9a7674b6db6)

## Variable-Length Records
- Variable-length recordsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:
  - í•˜ë‚˜ì˜ fileì— multiple record typesì„ ì €ì¥í•˜ëŠ” ê²½ìš°
  - one or more fields(ì˜ˆ: ë¬¸ìì—´ varchar)ì˜ ê¸¸ì´ê°€ variable lengthsì¸ Record types
  - repeating fields(ë°°ì—´ì´ë‚˜ ë©€í‹°ì…‹)ë¥¼ í—ˆìš©í•˜ëŠ” Record types <br>
- ê°€ë³€ ê¸¸ì´ ë ˆì½”ë“œë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•
  - Two parts: fixed length attributesì´ ìˆëŠ” initial partê³¼ variable length attributesë¶€ë¶„ì—ëŠ” ë°ì´í„°ê°€ ìˆë‹¤.
  - variable length attributeëŠ” (offset, length)ë¡œ ê³ ì • í¬ê¸° ì˜ì—­ì— ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ì‹¤ì œ ê°’ì€ ë ˆì½”ë“œ ë’¤ìª½ì— ë”°ë¡œ ì €ì¥í•œë‹¤
  - Null ê°’ì€ null-value ë¹„íŠ¸ë§µìœ¼ë¡œ í‘œí˜„ëœë‹¤ <br>

![image](https://github.com/user-attachments/assets/d5ddf809-8058-4b32-b70d-432e3c59c031)

## Variable-Length Records: Slotted Page Structure
- ì—¬ëŸ¬ ê°œì˜ variable-length recordsë¥¼ í•˜ë‚˜ì˜ ë¸”ë¡ì— ì €ì¥í•˜ëŠ” ë°©ë²•:
- slotted page headerì—ëŠ” ë‹¤ìŒ ì •ë³´ê°€ í¬í•¨ë¨:
  - ë ˆì½”ë“œ í•­ëª©ì˜ ê°œìˆ˜
  - ë¸”ë¡ ë‚´ì˜ ë‚¨ì€ ê³µê°„(free space)ì˜ ë ìœ„ì¹˜
  - ê° ë ˆì½”ë“œì˜ ìœ„ì¹˜ì™€ í¬ê¸°
- RecordsëŠ” í˜ì´ì§€ ë‚´ì—ì„œ ì—°ì†ë˜ë„ë¡ ë¹ˆ ê³µê°„ ì—†ì´ ì´ë™ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°, ì´ë•Œ entry in the headerê°€ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•œë‹¤.
- PointersëŠ” recordë¥¼ ì§ì ‘ ê°€ë¦¬í‚¤ì§€ ì•Šê³ , ëŒ€ì‹  headerì— ìˆëŠ” í•´ë‹¹ ë ˆì½”ë“œì˜ í•­ëª©(entry)ì„ ê°€ë¦¬ì¼œì•¼ í•œë‹¤. <br>

![image](https://github.com/user-attachments/assets/9ba949e8-9492-4b6f-a66f-8c0aa3b356e3)

## Organization of Records in Files
- íŒŒì¼ì— set of recordsë¥¼ ë°°ì¹˜í•˜ëŠ” ë°©ë²•:
- í™(Heap): ë ˆì½”ë“œëŠ” íŒŒì¼ ë‚´ì˜ ë¹ˆ ê³µê°„ ì–´ë””ë“ ì§€ ì €ì¥ë  ìˆ˜ ìˆë‹¤. -> ì œì¼ ë§ì´ ì“´ë‹¤. ê³µê°„ìˆê³ , ì •ì±…X, fileë„ heap fileì¡´ì¬, record ë„£ì„ë•Œ ë¹„ì›Œìˆìœ¼ë©´ ë„£ëŠ”ë‹¤.
- ìˆœì°¨(Sequential): ê° ë ˆì½”ë“œì˜ search key ê°’ì— ë”°ë¼ ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì €ì¥í•œë‹¤. -> ì´ì–´ ë¶™ì´ê¸° + ì •ë ¬(pkê°€ ê¸°ì¤€)
- í•´ì‹±(Hashing): ë ˆì½”ë“œì˜ íŠ¹ì • ì†ì„±ì— ëŒ€í•´ í•´ì‹œ í•¨ìˆ˜ë¥¼ ê³„ì‚°í•˜ê³ , ê·¸ ê²°ê³¼ì— ë”°ë¼ ë ˆì½”ë“œë¥¼ ì €ì¥í•  ë¸”ë¡ì´ ê²°ì •ëœë‹¤. -> ì •ë ¬O -> binarysearchë¡œ ì¢€ë” ë¹ ë¥´ê²Œ

## Sequential File Organization
- ì „ì²´ íŒŒì¼ì„ ìˆœì°¨ì (sequential)ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì— ì í•©í•˜ë‹¤
- The records in the fileì€ search-keyì— ë”°ë¼ ì •ë ¬ë˜ì–´ ìˆë‹¤ <br>

![image](https://github.com/user-attachments/assets/5f839dc9-7fdc-4cba-ac9c-97d438ad033c) <br>
- Deletion: í¬ì¸í„° ì²´ì¸(pointer chain)ì„ ì‚¬ìš©í•˜ì—¬ ì²˜ë¦¬í•œë‹¤.
- Insertion: ë ˆì½”ë“œë¥¼ ì‚½ì…í•  ìœ„ì¹˜ë¥¼ ì°¾ëŠ”ë‹¤.
  - ë¹ˆ ê³µê°„ì´ ìˆë‹¤ë©´ ê·¸ ìë¦¬ì— ì‚½ì…
  - ë¹ˆ ê³µê°„ì´ ì—†ë‹¤ë©´ ì˜¤ë²„í”Œë¡œìš° ë¸”ë¡(overflow block)ì— ì‚½ì…
  - ì–´ë–¤ ê²½ìš°ë“  í¬ì¸í„° ì²´ì¸(pointer chain)ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•œë‹¤
- sequential orderë¥¼ restoreí•˜ê¸° ìœ„í•´ fileì„ ì£¼ê¸°ì ìœ¼ë¡œ ì¬êµ¬ì„±(reorganize)í•´ì•¼ í•œë‹¤.

## Storage Access
- database fileì€ blockì´ë¼ ë¶ˆë¦¬ëŠ” fixed-length storage unitsë¡œ ë¶„í• (partitioned)ëœë‹¤.<br>
  blockì€ ì €ì¥ í• ë‹¹(storage allocation)ê³¼ ë°ì´í„° ì „ì†¡(data transfer)ì˜ ë‹¨ìœ„(units)ì´ë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì€ diskì™€ memory ê°„ì˜ block ì „ì†¡ ìˆ˜ë¥¼ ìµœì†Œí™”í•˜ë ¤ê³  í•œë‹¤.<br>
  ë””ìŠ¤í¬ ì ‘ê·¼ íšŸìˆ˜(the number of disk accesses)ë¥¼ ì¤„ì´ê¸° ìœ„í•´, ê°€ëŠ¥í•œ ë§ì€ ë¸”ë¡ì„ main memoryì— ìœ ì§€í•œë‹¤.
- Buffer: disk blocksì˜ ë³µì‚¬ë³¸ì„ ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” main memoryì˜ ì¼ë¶€ ê³µê°„ì´ë‹¤.
- Buffer manager: main memory ë‚´ì—ì„œ ë²„í¼ ê³µê°„ì„ í• ë‹¹í•˜ëŠ” ì—­í• ì„ í•˜ëŠ” í•˜ìœ„ ì‹œìŠ¤í…œ(subsystem)ì´ë‹¤.

## Buffer Manager
- programì´ diskì—ì„œ blockì´ í•„ìš”í•  ë•Œ buffer managerë¥¼ í˜¸ì¶œí•œë‹¤.
1. ë¸”ë¡ì´ ì´ë¯¸ ë²„í¼ì— ì¡´ì¬í•˜ë©´, ë²„í¼ ê´€ë¦¬ìëŠ” returns the address of the block in main memory.
2. ë¸”ë¡ì´ ë²„í¼ì— ì—†ìœ¼ë©´, ë²„í¼ ê´€ë¦¬ìëŠ” ë‹¤ìŒì„ ìˆ˜í–‰í•œë‹¤:
   1. í•´ë‹¹ ë¸”ë¡ì„ ìœ„í•œ ë²„í¼ ê³µê°„ì„ í• ë‹¹í•œë‹¤
      1. ê³µê°„ì´ ë¶€ì¡±í•  ê²½ìš°, ë‹¤ë¥¸ ë¸”ë¡ì„ êµì²´(ë²„ë¦¼)í•˜ì—¬ ìƒˆ ë¸”ë¡ì´ ë“¤ì–´ê°ˆ ìë¦¬ë¥¼ ë§Œë“ ë‹¤.
      2. êµì²´ë˜ëŠ” ë¸”ë¡ì€ ìˆ˜ì •ëœ ê²½ìš°ì—ë§Œ ë””ìŠ¤í¬ì— ë‹¤ì‹œ ê¸°ë¡ëœë‹¤ (ê°€ì¥ ìµœê·¼ì˜ ì½ê¸°/ì“°ê¸° ì´í›„ ë³€ê²½ë˜ì—ˆì„ ë•Œë§Œ).
   2. ë””ìŠ¤í¬ì—ì„œ ë¸”ë¡ì„ ì½ì–´ì™€ ë²„í¼ì— ì €ì¥í•œ í›„, ìš”ì²­ì(requester)ì—ê²Œ returns the address of the block in main memory.

## Buffer-Replacement Policies
- ëŒ€ë¶€ë¶„ì˜ OSëŠ” Least Recently Used(LRU)ì„ êµì²´í•˜ëŠ” ì „ëµì„ ì‚¬ìš©í•œë‹¤.
- LRUì˜ ê¸°ë³¸ ì•„ì´ë””ì–´: ê³¼ê±°ì˜ ë¸”ë¡ ì°¸ì¡° íŒ¨í„´ì„ ë¯¸ë˜ì˜ ì°¸ì¡° íŒ¨í„´ì— ëŒ€í•œ ì˜ˆì¸¡ìœ¼ë¡œ í™œìš©í•œë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ëŠ” ëª…í™•í•œ ì ‘ê·¼ íŒ¨í„´(access patterns)(such as sequential scans)ì„ ê°€ì§€ë¯€ë¡œ, DBMSëŠ” ì¿¼ë¦¬ ì •ë³´ë¥¼ ì´ìš©í•´ ë¯¸ë˜ì˜ ì°¸ì¡°ë¥¼ ì˜ˆì¸¡í•  ìˆ˜ ìˆë‹¤.
  - LRUëŠ” ë°ì´í„°ë¥¼ ë°˜ë³µì ìœ¼ë¡œ ìŠ¤ìº”í•˜ëŠ” íŠ¹ì • ì ‘ê·¼ íŒ¨í„´ì—ì„œëŠ” ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆë‹¤. -> ë‘ ë¦´ë ˆì´ì…˜ ì¤‘ì²© ì¡°ì¸
  - ë”°ë¼ì„œ query optimizerê°€ êµì²´ ì „ëµì— ëŒ€í•œ íŒíŠ¸ë¥¼ ì œê³µí•˜ëŠ” mixed strategyê°€ ë” ë°”ëŒì§í•˜ë‹¤.
- ìµœì‹  ì‚¬ìš©(MRU: Most Recently Used) ì „ëµ
  - ì‹œìŠ¤í…œì€ í˜„ì¬ ì²˜ë¦¬ ì¤‘ì¸ ë¸”ë¡ì„ pin í•œë‹¤.<br>
  í•´ë‹¹ ë¸”ë¡ì˜ ë§ˆì§€ë§‰ íŠœí”Œê¹Œì§€ ì²˜ë¦¬í•˜ë©´ ë¸”ë¡ì˜ unpinnedë˜ê³ , ì´ ë¸”ë¡ì€ ê°€ì¥ ìµœê·¼ì— ì‚¬ìš©ëœ ë¸”ë¡(most recently used block)ì´ ëœë‹¤.
    - pinned block: ë””ìŠ¤í¬ë¡œ ë‹¤ì‹œ ì“°ì—¬ì„œëŠ” ì•ˆ ë˜ëŠ” ë©”ëª¨ë¦¬ ë¸”ë¡ì´ë‹¤.
- Buffer managerëŠ” particular relationì´ ì°¸ì¡°ë  í™•ë¥ ì— ê´€í•œ í†µê³„ ì •ë³´ë¥¼ í™œìš©í•  ìˆ˜ ìˆë‹¤.
  - ì˜ˆ: ë°ì´í„° ì‚¬ì „(data dictionary)ì€ ìì£¼ ì ‘ê·¼ëœë‹¤. Heuristic: data dictionary blocksì€ main memory bufferì— ìœ ì§€í•œë‹¤. 

-------------------------------------------------------------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------------------------------

# 8. indexing
## Motivation
- databasesì—ì„œì˜ index: ì°¾ê³ ì í•˜ëŠ” recordsë¥¼ ë¹ ë¥´ê²Œ ì°¾ê¸° ìœ„í•´ ì„¤ê³„ëœ data structureì´ë‹¤.
  - ì™œ ê·¸ë ‡ê²Œ ë§ì€ ì¢…ë¥˜ì˜ ì¸ë±ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ”ê°€? -> ë‹¤ì–‘í•œ data typesê³¼ queriesë•Œë¬¸
- indexê°€ í•„ìš”í•œ ì´ìœ ëŠ”?
  - sql queryë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ì„œ

## Basic Concepts
- ì›í•˜ëŠ” dataì— ëŒ€í•œ ì ‘ê·¼ì„ ë¹ ë¥´ê²Œ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” indexsing mechanisms
- Search Key: fileì—ì„œ recordsë¥¼ ì°¾ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” í•˜ë‚˜ ì´ìƒì˜ attribute
- index fileì€ ë‹¤ìŒ í˜•íƒœì˜ records(index entriesë¼ê³  ë¶€ë¦„)ë¡œ êµ¬ì„±ëœë‹¤.<br>
  ![image](https://github.com/user-attachments/assets/8aff93f6-a41b-4036-985f-a4cacb5cc985)<br>
- Index filesì€ ì¼ë°˜ì ìœ¼ë¡œ original fileë³´ë‹¤ ì‘ë‹¤.
- indicesì˜ 2ê°€ì§€ ê¸°ë³¸ ì¢…ë¥˜:
  - Ordered indices(ìˆœì°¨ ì¸ë±ìŠ¤): search keysê°€ ì •ë ¬ëœ ìˆœì„œë¡œ ì €ì¥ëœë‹¤.
  - Hash indices(í•´ì‹œ ì¸ë±ìŠ¤): search keysê°€ hash functionì„ ì‚¬ìš©í•˜ì—¬ bucketsì— ê· ë“±í•˜ê²Œ ë¶„ë°°ëœë‹¤.

## Index Evaluation Metrics (DB ì¸ë±ìŠ¤ ì„±ëŠ¥ í‰ê°€ ì£¼ìš” ì§€í‘œ)
- íš¨ìœ¨ì ìœ¼ë¡œ ì§€ì›ë˜ëŠ” ì ‘ê·¼ ìœ í˜•
  - íŠ¹ì • ì†ì„± ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” ë ˆì½”ë“œë“¤ -> name = 'Alice'ì¸ ê²ƒì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆëŠ”ê°€?
  - ë˜ëŠ” ì†ì„± ê°’ì´ íŠ¹ì • ë²”ìœ„ ë‚´ì— í¬í•¨ë˜ëŠ” ë ˆì½”ë“œë“¤ -> ageê°€ 20 ~ 30ì‚¬ì´ì¸ ê°’ì„ ë¹ ë¥´ê²Œ ì°¾ì„ ìˆ˜ ìˆëŠ”ê°€?
- Access time -> ì°¾ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- Insertion time -> ì‚½ì…í•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- Deletion time -> ì‚­ì œí•˜ëŠ”ë° ê±¸ë¦¬ëŠ” ì‹œê°„
- Space overhead -> ì¶”ê°€ì ìœ¼ë¡œ ê³µê°„ì´ í•„ìš”í•˜ì§€ ì•Šì€ì§€? <br>

![image](https://github.com/user-attachments/assets/8a486c04-4d8f-44e7-875d-338b4e590e5b)

## Ordered Indices
- ordered index: index entriesê°€ search key valueì— ë”°ë¼ ì •ë ¬ëœ ìƒíƒœë¡œ ì €ì¥ 
- primary index(=clustering index): ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬ëœ íŒŒì¼ì—ì„œ, search keyê°€ fileì˜ ì •ë ¬ ìˆœì„œë¥¼ ì§€ì •í•˜ëŠ” index
  - search keyê°€ ë°˜ë“œì‹œ primary keyê°€ ì•„ë‹ˆë‹¤
- secondary(ë³´ì¡°) index(=non-clustering index): search keyê°€ íŒŒì¼ì˜ sequential ì •ë ¬ ìˆœì„œ(data ì •ë ¬ìˆœì„œ)ì™€ ë‹¤ë¥¸ ìˆœì„œë¥¼ ì§€ì •í•˜ëŠ” indexì´ë‹¤.<br>
- index-sequential file: primary indexë¥¼ ê°–ëŠ” ì •ë ¬ëœ ìˆœì°¨ íŒŒì¼

## Dense Index Files(index êµ¬ë¶„ ì†ì„± dense VS sparse)
- Dense index: fileì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  search-key valueë§ˆë‹¤ Index recordê°€ ì¡´ì¬í•˜ëŠ” index.<br>
ì „ë¶€ ê°™ì´ ì¡´ì¬í•´ì„œ ë°€ë„ê°€ ë†’ë‹¤.
- Dense index on dept_name, with instructor file sorted on dept_name<br>
![image](https://github.com/user-attachments/assets/04433090-5e83-4f9f-9339-de499060a129) <br>
ë‹¤ë§Œ dense indexìˆ˜ê°€ recordì™€ ê°™ì„ í•„ìš”ëŠ” ì—†ëŠ”ë° ê·¸ ì´ìœ ëŠ” ì¤‘ë³µì´ ë ìˆ˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤.

## Sparse Index Files(ë°˜ë“œì‹œ primary indexì´ë‹¤)
- Sparse Index: ì¼ë¶€ search-key valuesì— ëŒ€í•´ì„œë§Œ ì¸ë±ìŠ¤ recordsë¥¼ í¬í•¨í•˜ëŠ” index
  - search-keyë¥¼ ê¸°ì¤€ìœ¼ë¡œ recordsê°€ ìˆœì°¨ì ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆì„ ë•Œ ì ìš© ê°€ëŠ¥
- search-key value Kë¥¼ ê°€ì§„ recordsë¥¼ ì°¾ê¸° ìœ„í•´ì„œëŠ”:
  - Kë³´ë‹¤ ì‘ìœ¼ë©´ì„œ ê°€ì¥ í° search-key valueì„ ê°€ì§„ index recordë¥¼ ì°¾ê³ 
  - í•´ë‹¹ ì¸ë±ìŠ¤ ë ˆì½”ë“œê°€ ê°€ë¦¬í‚¤ëŠ” ë ˆì½”ë“œë¶€í„° íŒŒì¼ì„ ìˆœì°¨ì ìœ¼ë¡œ ê²€ìƒ‰í•œë‹¤<br>
  
![image](https://github.com/user-attachments/assets/e74dedcb-435a-4769-81ac-053deba5a8b8)<br>
- dense indicesì™€ ë¹„êµ:
  - ê³µê°„ì„ ëœ ì°¨ì§€, ì‚½ì… ë° ì‚­ì œ ì‹œ ìœ ì§€ ê´€ë¦¬ ë¹„ìš©ì´ ë” ì ë‹¤.
  - ë ˆì½”ë“œë¥¼ ì°¾ëŠ” ì†ë„ëŠ” dense indexë³´ë‹¤ ëŠë¦¬ë‹¤.
 - ì ˆì¶©ì•ˆ: íŒŒì¼ì˜ ê° ë¸”ë¡ë§ˆë‹¤, í•´ë‹¹ ë¸”ë¡ì—ì„œì˜ ê°€ì¥ ì‘ì€ search-key valueì— ëŒ€ì‘í•˜ëŠ”
   ì¸ë±ìŠ¤ í•­ëª©ì„ í•˜ë‚˜ì”© ê°–ëŠ” sparse index.<br>
![image](https://github.com/user-attachments/assets/89366540-9434-4e3b-a3d2-9cafe3c0dcf6)<br>

## Multilevel Index
- primary(ê¸°ë³¸) indexê°€ ë©”ëª¨ë¦¬ì— ëª¨ë‘ ë“¤ì–´ê°€ì§€ ì•Šìœ¼ë©´, ì ‘ê·¼ ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤.
- Solution: ë””ìŠ¤í¬ì— ì €ì¥ëœ primary indexë¥¼ sequential fileë¡œ ë³´ê³ , ê·¸ ìœ„ì— sparse indexë¥¼ ìƒì„±í•œë‹¤.
  - outer index: primary indexì˜ sparse index
  - inner index: primary index file
- ë§Œì•½ ì™¸ë¶€ ì¸ë±ìŠ¤ì¡°ì°¨ ë©”ì¸ ë©”ëª¨ë¦¬ì— ë“¤ì–´ê°€ì§€ ì•Šì„ ì •ë„ë¡œ í¬ë‹¤ë©´, ë˜ í•˜ë‚˜ì˜ ì¸ë±ìŠ¤ ë ˆë²¨ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
- ëª¨ë“  ë ˆë²¨ì˜ ì¸ë±ìŠ¤ëŠ” íŒŒì¼ì— ì‚½ì…(insert) ë˜ëŠ” ì‚­ì œ(delete)ê°€ ë°œìƒí•  ë•Œë§ˆë‹¤ í•¨ê»˜ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•œë‹¤<br>
![image](https://github.com/user-attachments/assets/3cd4fa88-daef-4545-8bc6-93b7fdc59db5) <br>
![image](https://github.com/user-attachments/assets/861b5780-b99d-42f2-8f34-2f24ec76d0b2) <br>
![image](https://github.com/user-attachments/assets/abc717b8-9aaa-403a-a3a0-cf0a6ddd2fc5) <br>
ì¦‰, indexì˜ indexë¥¼ ë§Œë“œëŠ” mutil indexêµ¬ì¡°ì´ë‹¤. <br>

![image](https://github.com/user-attachments/assets/b0454c03-e7c6-4725-a18a-81e5d1a1777a)<br>
![image](https://github.com/user-attachments/assets/c53cfacb-30d7-47ad-a8a5-3e350441aee3)

## Index Update: Deletion
- ì‚­ì œëœ recordê°€ í•´ë‹¹ search-key valueë¥¼ ê°€ì§„ file ë‚´ ìœ ì¼í•œ recordì˜€ë‹¤ë©´, ê·¸ ê²€ìƒ‰ í‚¤ë„ indexì—ì„œ ì‚­ì œëœë‹¤.
- Single-level index entry deletion:
  - Dense indices: search-key ì‚­ì œëŠ” file record deletionê³¼ ìœ ì‚¬í•˜ë‹¤.
  - Sparse indices
    - indexì— í•´ë‹¹ search key í•­ëª©ì´ ì¡´ì¬í•˜ë©´, ê·¸ í•­ëª©ì€ íŒŒì¼ ë‚´ next search-key value(in search key order)ìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ì‚­ì œí•œë‹¤.<br>
    ì˜ˆë¡œ D -> (4 D,5 E,6 F)ì¼ë–„ Dë¥¼ ì‚­ì œí•œë‹¤ë©´ E -> (5 E, 6 F)ê°€ ëœë‹¤.
    - ë§Œì•½ next search-key valueì´ ì´ë¯¸ ì¸ë±ìŠ¤ í•­ëª©ìœ¼ë¡œ ì¡´ì¬í•œë‹¤ë©´, ëŒ€ì²´í•˜ì§€ ì•Šê³  í•´ë‹¹ í•­ëª©ì„ ì‚­ì œí•œë‹¤. <br>
    ì˜ˆë¡œ D -> (4, D) E -> (5 E, 6 F) ì´ê³ , Dì™€ Eê°€ ê°ê° íŠ¹ì • ë¶€ë¶„ì„ ëŒ€í‘œí•˜ëŠ” ê²½ìš°ì¼ë•Œ ê·¸ëƒ¥ Dë§Œ ì‚­ì œí•œë‹¤. <br>
- ì‚­ì œ ë°˜ë³µìœ¼ë¡œ ì¸í•œ blockì— ë¹ˆ ê³µê°„ ìƒì„± <br>
![image](https://github.com/user-attachments/assets/c779aec2-3e59-47fb-b331-5df5bf9d647b)<br>
DB ì¸ë±ìŠ¤(í˜¹ì€ ë°ì´í„°) ë¸”ë¡ ê´€ë¦¬ì—ì„œ ì‚­ì œê°€ ë°˜ë³µë˜ë©´ ë¸”ë¡ì— ë¹ˆ ê³µê°„ì´ ìƒê¸´ë‹¤. <br>
ì‚½ì… ì‹œ ê¸°ì¡´ ë¸”ë¡ì˜ ë¹ˆ ê³µê°„ì„ í™œìš©í•˜ì§€ ì•Šê³  ìƒˆ ë¸”ë¡ì„ ë§Œë“œëŠ” ê²½ìš°, ì „ì²´ì ìœ¼ë¡œ ê³µê°„ì´ ë‚­ë¹„ëœë‹¤. <br>
ê·¸ë˜ì„œ ê·¹ë‹¨ì ì¸ ê²½ìš°ë¡œ 1ê°œì”©ë§Œ ìˆëŠ” ê²½ìš°ëŠ” ì „ì²´ì˜ ê°œìˆ˜ê°€ ì¤„ì§€ì•Šê²Œ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. -> ê³µê°„ ë¹„íš¨ìœ¨ <br>
ë”°ë¼ì„œ ì–´ëŠ ì •ë„ ë¸”ë¡ì„ ì±„ìš°ëŠ” ì •ì±…(ì˜ˆ: fill factor ë“±)ì„ ì ìš©í•´ì•¼ í•˜ë©°, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ DBì˜ ì €ì¥ íš¨ìœ¨ì´ í¬ê²Œ ì €í•˜ë©ë‹ˆë‹¤.

## Index Update: Insertion
- Single-level index insertion:
  - ì‚½ì…í•  recordì— ë‚˜íƒ€ë‚˜ëŠ” search-key valueì„ ì‚¬ìš©í•˜ì—¬ ì¡°íšŒë¥¼ ìˆ˜í–‰í•œë‹¤.
  - Dense indices: ê²€ìƒ‰ í‚¤ ê°’ì´ ì¸ë±ìŠ¤ì— ì—†ë‹¤ë©´ ì‚½ì…í•œë‹¤.
  - Sparse indices: ì¸ë±ìŠ¤ê°€ íŒŒì¼ì˜ ê° ë¸”ë¡ì— ëŒ€í•œ í•­ëª©ë§Œ ì €ì¥í•œë‹¤ë©´, ìƒˆë¡œìš´ ë¸”ë¡ì´ ìƒì„±ë˜ì§€ ì•ŠëŠ” í•œ ì¸ë±ìŠ¤ì— ë³€ê²½ì„ ê°€í•  í•„ìš”ê°€ ì—†ë‹¤.
    - ìƒˆë¡œìš´ ë¸”ë¡ì´ ìƒì„±ë˜ë©´, í•´ë‹¹ ë¸”ë¡ì— ì²˜ìŒ ë‚˜íƒ€ë‚˜ëŠ” ê²€ìƒ‰ í‚¤ ê°’ì„ ì¸ë±ìŠ¤ì— ì‚½ì…í•œë‹¤.
- Multilevel insertion and deletion: ì•Œê³ ë¦¬ì¦˜ì€ ë‹¨ì¼ ìˆ˜ì¤€ ì•Œê³ ë¦¬ì¦˜ì˜ ë‹¨ìˆœí•œ í™•ì¥ì´ë‹¤.

## Secondary Indices
- í”íˆ ì–´ë–¤ field(ê¸°ë³¸ ì¸ë±ìŠ¤ì˜ search-keyê°€ ì•„ë‹Œ)ì˜ valueê°€ íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ëª¨ë“  recordë¥¼ ì°¾ê³ ì í•˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤.
  - Ex) ID ê¸°ì¤€ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥ëœ instructor ë¦´ë ˆì´ì…˜ì—ì„œ, íŠ¹ì • í•™ê³¼ì— ì†í•œ ëª¨ë“  êµìˆ˜ë¥¼ ì°¾ê³ ì í•  ìˆ˜ ìˆë‹¤.
- ì´ëŸ¬í•œ ê²½ìš°, ê° search-key valueì— ëŒ€í•´ index recordë¥¼ ê°€ì§€ëŠ” secondary(ë³´ì¡°) indexë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. <br>

## Secondary Indices Example
![image](https://github.com/user-attachments/assets/0a6111d0-4b61-4e77-bee1-067074db0813) <br>
- Index recordëŠ” í•´ë‹¹ search-key valueë¥¼ ê°€ì§„ ì‹¤ì œ recordsë¥¼ ëª¨ë‘ ê°€ë¦¬í‚¤ëŠ” pointersê°€ ë“¤ì–´ ìˆëŠ” bucketì„ ê°€ë¦¬í‚¨ë‹¤.
- secondary indexëŠ” ë°˜ë“œì‹œ dense indexì—¬ì•¼ í•œë‹¤.

## Primary and Secondary Indices
- indexëŠ” recordë¥¼ ê²€ìƒ‰í•  ë•Œ ìƒë‹¹í•œ ì´ì ì„ ì œê³µí•œë‹¤.
- BUT: Updating indicesì€ ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì • ì‹œ ì˜¤ë²„í—¤ë“œë¥¼ ì´ˆë˜í•œë‹¤ â€”> íŒŒì¼ì´ ìˆ˜ì •ë˜ë©´, ê·¸ íŒŒì¼ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ì¸ë±ìŠ¤ë¥¼ ê°±ì‹ í•´ì•¼ í•œë‹¤.
- primary indexë¥¼ ì‚¬ìš©í•œ Sequential scanì€ íš¨ìœ¨ì ì´ì§€ë§Œ, secondary indexë¥¼ ì‚¬ìš©í•œ sequential scanì€ ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤.
  - ê° recordë¥¼ ì ‘ê·¼í•  ë•Œë§ˆë‹¤ diskì—ì„œ new blockì„ ê°€ì ¸ì™€ì•¼ í•  ìˆ˜ ìˆë‹¤.
  - blockì„ ê°€ì ¸ì˜¤ëŠ” ë°ëŠ” ì•½ 5~10ë°€ë¦¬ì´ˆê°€ ê±¸ë¦¬ë©°, ì´ëŠ” ë©”ëª¨ë¦¬ ì ‘ê·¼ ì‹œê°„ì¸ ì•½ 100ë‚˜ë…¸ì´ˆì— ë¹„í•´ í›¨ì”¬ ëŠë¦¬ë‹¤.
- ì •ë ¬ì„ ì‹œí‚¨ë‹¤. -> cost: $O\left(\frac{N}{B} \log_{\frac{N}{B}} \frac{N}{B}\right)$ - O(N) I/O's ë³´ë‹¤ ì‘ë‹¤.

## $B^+$-Tree Index Files
- $B^+$-tree indicesëŠ” indexed-sequential filesì˜ ëŒ€ì•ˆì´ë‹¤.
  - indexed-sequential filesì˜ ë‹¨ì 
    - fileì´ ì»¤ì§ˆìˆ˜ë¡ ë§ì€ overflow blockì´ ìƒì„±ë˜ì–´ performanceê°€ ì €í•˜ëœë‹¤.
    - ì „ì²´ íŒŒì¼ì„ ì£¼ê¸°ì ìœ¼ë¡œ ì¬êµ¬ì„±(reorganization)í•´ì•¼ í•œë‹¤.
  - $B^+$-tree indices íŒŒì¼ì˜ ì¥ì :
    - ë³€í™”ê°€ ìˆëŠ” ë¶€ë¶„ë§Œ ìë™ìœ¼ë¡œ ì¬êµ¬ì„±(reorganization)í•œë‹¤.
  - $B^+$-íŠ¸ë¦¬ì˜ ë‹¨ì :
    - ì‚½ì… ë° ì‚­ì œì— ì¶”ê°€ì ì¸ overheadì™€ ê³µê°„ overheadê°€ ìˆë‹¤.
  - $B^+$-íŠ¸ë¦¬ì˜ ì¥ì ì´ ë‹¨ì ë³´ë‹¤ í¬ë©°, ë„ë¦¬ ì‚¬ìš©ë˜ê³  ìˆë‹¤.
   
## Example of $B^+$-Tree(dense, sparse ë‹¤ ê°€ëŠ¥í•˜ë‹¤)
![image](https://github.com/user-attachments/assets/14840478-5261-429e-8ffe-65b7568b87c7) <br>
![image](https://github.com/user-attachments/assets/347be7ba-d695-4835-bb8f-877602490b7f) <br>
![image](https://github.com/user-attachments/assets/9983d4ca-7b14-4322-86ca-942c20f817a4)

## $B^+$-Tree Index Files (Cont.) 
- rootì—ì„œ leafê¹Œì§€ ëª¨ë“  pathsì˜ lengthê°€ ê°™ë‹¤.
- rootë‚˜ leafê°€ ì•„ë‹Œ nodeëŠ” childrenì˜ ìˆ˜ê°€ $\left\lceil \frac{n}{2} \right\rceil$ ì´ìƒ n ì´í•˜ì´ë‹¤.
- leaf nodeëŠ” ê°’ì˜ ê°œìˆ˜ê°€ $\left\lceil \frac{(n-1)}{2} \right\rceil$ ì´ìƒ nâ€“1 ì´í•˜ì´ë‹¤.
- Special ê²½ìš°:
  - rootê°€ leafê°€ ì•„ë‹ˆë©´, ìµœì†Œ 2ê°œì˜ childrenì„ ê°€ì§„ë‹¤.
  - rootê°€ leafì¸ ê²½ìš°, 0ê°œì—ì„œ (nâ€“1)ê°œì˜ ê°’ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.

## $B^+$-Tree Node Structure
- ì¼ë°˜ì ì¸ ë…¸ë“œ <br>
  ![image](https://github.com/user-attachments/assets/5acda8ab-ed65-4546-8fb8-3d50b9116954) <br>
  - $K_i$ëŠ” search-key valuesì´ë‹¤.
  - $P_i$ëŠ” ìì‹ ë…¸ë“œë¥¼ ê°€ë¦¬í‚¤ëŠ” í¬ì¸í„°(non-leaf nodesì˜ ê²½ìš°)ì´ê±°ë‚˜ leaf nodeì—ì„œëŠ” ì‹¤ì œ ë°ì´í„°(buckets)ì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” pointersì´ë‹¤.
- ë…¸ë“œ ë‚´ì˜ ê²€ìƒ‰ í‚¤ë“¤ì€ $K_1 < K_2 < K_3 < \dots < K_{n-1}$ ìˆœì„œë¡œ ì •ë ¬ë˜ì–´ ìˆë‹¤.

## Leaf Nodes in $B^+$-Trees
leaf nodeì˜ íŠ¹ì„±:
- $i = 1, 2, \dots, n-1$ì— ëŒ€í•´, pointer $P_i$ëŠ” search-key valueì´ $K_i$ì¸ file recordë¥¼ ê°€ë¦¬í‚¨ë‹¤.
- ë§Œì•½ $L_i$, $L_j$ê°€ leaf nodesì´ê³  $i < j$ë¼ë©´, $L_i$ì˜ ê²€ìƒ‰ í‚¤ ê°’ë“¤ì€ $L_j$ì˜ search-key valuesë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ë‹¤.
- $P_n$ì€ search-key orderì—ì„œ next leaf nodeë¥¼ ê°€ë¦¬í‚¨ë‹¤. <br>

![image](https://github.com/user-attachments/assets/2d675031-c2c2-4ac6-a2b1-03df5289e2ae)

## Non Leaf Nodes in $B^+$-Trees
- Non leaf nodesëŠ” leaf nodesì— ëŒ€í•œ multi-level sparse indexë¥¼ í˜•ì„±í•œë‹¤. <br>
  non-leaf nodeì— pointersê°€ mê°œ ìˆì„ ë•Œ:
  - $P_1$ì´ ê°€ë¦¬í‚¤ëŠ” subtreeì˜ ëª¨ë“  search-keys ê°’ì€ $K_1$ë³´ë‹¤ ì‘ë‹¤.
  - $2 \leq i \leq n-1$ì¸ ê²½ìš°, $P_i$ê°€ ê°€ë¦¬í‚¤ëŠ” subtreeì˜ ëª¨ë“  search-keys ê°’ì€ $K_{i-1}$ ì´ìƒì´ê³  $K_i$ ë¯¸ë§Œì´ë‹¤.
  - $P_n$ì´ ê°€ë¦¬í‚¤ëŠ” ì„œë¸ŒíŠ¸ë¦¬ì˜ ëª¨ë“  ê²€ìƒ‰ í‚¤ ê°’ì€ $K_{n-1}$ ì´ìƒì´ë‹¤. <br>

![image](https://github.com/user-attachments/assets/1a7dc67e-3f37-455a-b8c2-8ab6d92e9a8e)

## Example of $B^+$-tree
![image](https://github.com/user-attachments/assets/5d496260-bff2-41d7-9a71-a7c7c364b84b) <br>
instructor íŒŒì¼ì— ëŒ€í•œ $B^+$-íŠ¸ë¦¬ (n = 6)
- Leaf nodesì˜ ê°’ì´ $3$ê°œ ì´ìƒ $5$ê°œ ì´í•˜ì´ì–´ì•¼ í•œë‹¤ $\left( \lceil \frac{n - 1}{2} \rceil, n - 1\text{ì—ì„œ }n = 6 \right)$.
- rootë¥¼ ì œì™¸í•œ Non-leaf nodesëŠ” ìì‹ì´ $3$ê°œ ì´ìƒ $6$ê°œ ì´í•˜ì´ì–´ì•¼ í•œë‹¤ $\left( \lceil \frac{n}{2} \rceil, n\text{ì—ì„œ }n = 6 \right)$
- Root ìµœì†Œí•œ $2$ê°œì˜ childrenì„ ê°€ì ¸ì•¼ í•œë‹¤.

## Observations about $B^+$-trees
- inter-node connectionsì€ pointersë¡œ ì´ë£¨ì–´ì§€ë¯€ë¡œ, ë¬¼ë¦¬ì ìœ¼ë¡œ ê°€ê¹Œìš¸ í•„ìš”ëŠ” ì—†ë‹¤.
- $B^+$-treeì˜ non-leaf levelsì€ hierarchy of sparse indices(í¬ì†Œ ì¸ë±ìŠ¤ì˜ ê³„ì¸µ êµ¬ì¡°)ë¥¼ ì´ë£¬ë‹¤.
- $B^+$-treeëŠ” ë¹„êµì  small number of levels(ì ì€ ìˆ˜ì˜ ë ˆë²¨)ì„ ê°€ì§„ë‹¤.
  - Level below root(ë£¨íŠ¸ ë°”ë¡œ ì•„ë˜ ë ˆë²¨)ì€ ìµœì†Œ $2 \times \lceil \frac{n}{2} \rceil$ ê°œì˜ ê°’ì„ ê°€ì§„ë‹¤.
  - ê·¸ Next levelì€ ìµœì†Œ $2 \times \lceil \frac{n}{2} \rceil \times \lceil \frac{n}{2} \rceil$ ê°œì˜ ê°’ì„ ê°€ì§„ë‹¤.
  - fileì— search-key valuesì´ $K$ê°œ ìˆë‹¤ë©´, tree heightëŠ” ìµœëŒ€ $\lceil \log_{\lceil n/2 \rceil}(K) \rceil$ ì´ë‹¤.
  - ë”°ë¼ì„œ searchesëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ìˆ˜í–‰ë  ìˆ˜ ìˆë‹¤.
- main fileì— ëŒ€í•œ Insertionsê³¼ deletionsëŠ” indexë¥¼ ë¡œê·¸ ì‹œê°„ ë‚´ì— ì¬êµ¬ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

## Queries on $B^+$-Trees
- search-key value Vë¥¼ ê°€ì§„ recordë¥¼ ì°¾ëŠ”ë‹¤.
  1. $C = \text{root}$
  2. $C$ê°€ leaf nodeê°€ ì•„ë‹ ë™ì•ˆ {
     - $V \leq K_i$ë¥¼ ë§Œì¡±í•˜ëŠ” ìµœì†Œì˜ $i$ë¥¼ ì°¾ëŠ”ë‹¤.
     - ê·¸ëŸ° $i$ê°€ ì—†ë‹¤ë©´, $C$ë¥¼ $C$ì˜ ë§ˆì§€ë§‰ non-null pointerë¡œ ì„¤ì •í•œë‹¤.
     - Else { if (V = K_i) Set $C = P_{i+1}$ else C = p_i } <br>
â€ƒâ€ƒ }
  3. $K_i = V$ë¥¼ ë§Œì¡±í•˜ëŠ” ìµœì†Œì˜ $i$ë¥¼ ì°¾ëŠ”ë‹¤.
  4. ê·¸ëŸ° $i$ê°€ ìˆë‹¤ë©´, pointer $P_i$ë¥¼ ë”°ë¼ ì›í•˜ëŠ” recordë¡œ ì´ë™í•œë‹¤.
  5. ì—†ë‹¤ë©´, search-key value $V$ë¥¼ ê°€ì§„ recordëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤. <br>

![image](https://github.com/user-attachments/assets/988bdccb-615f-4fa6-9fe1-dce9952b4efc) <br>
- fileì— search-key valuesì´ $K$ê°œ ìˆì„ ë•Œ, treeì˜ heightëŠ” ìµœëŒ€ $\lceil \log_{\lceil n/2 \rceil}(K) \rceil$ ì´ë‹¤.
- nodeëŠ” ì¼ë°˜ì ìœ¼ë¡œ disk blockê³¼ í¬ê¸°ê°€ ê°™ìœ¼ë©°, ë³´í†µ 4KBì´ë‹¤.
  - ê·¸ë¦¬ê³  $n$ì€ ë³´í†µ ì•½ 100ì´ë‹¤ (ì¸ë±ìŠ¤ í•­ëª©ë‹¹ 40ë°”ì´íŠ¸ ê¸°ì¤€).
- 100ê°œì˜ ë¶„ê¸° ìˆ˜($n=100$)ì™€ 100ë§Œ ê°œ(1 million)ì˜ ê²€ìƒ‰ í‚¤ ê°’(search key values)ì´ ìˆì„ ë•Œ
  - ì¡°íšŒ(lookup) ì‹œ ìµœëŒ€ $\log_{50}(1,000,000) = 4$ ë…¸ë“œê°€ ì ‘ê·¼ëœë‹¤. -> ìµœì•…ì˜ ê²½ìš° B/2 = 50ì´ì—¬ì„œ max 4ë²ˆì´ë‹¤.  
- 1ë°±ë§Œ(1 million) ê°œ ê²€ìƒ‰ í‚¤ ê°’ì„ ê°€ì§„ ê· í˜• ì´ì§„ íŠ¸ë¦¬(balanced binary tree)ì™€ ë¹„êµí•˜ë©´ -> <br>
  ì¡°íšŒ(lookup) ì‹œ ì•½ 20ê°œì˜ nodesê°€ ì ‘ê·¼ëœë‹¤.
  - ì´ differenceëŠ” ì¤‘ìš”í•˜ë‹¤. ì™œëƒí•˜ë©´ ê° node ì ‘ê·¼ë§ˆë‹¤ disk I/Oê°€ í•„ìš”í•  ìˆ˜ ìˆê³ , ì´ë¡œ ì¸í•´ ì•½ 20 millisecondsì˜ ë¹„ìš©ì´ ë“¤ê¸° ë•Œë¬¸ì´ë‹¤. <br>

![image](https://github.com/user-attachments/assets/7c618d02-cba3-49ba-9d8c-901e7713c12d) <br>
![image](https://github.com/user-attachments/assets/8b82d52c-2ee2-4a79-a6f7-67c2aece68d0) <br>
![image](https://github.com/user-attachments/assets/a2fb0c5b-307e-445e-bdf8-6b07c2aa1721) <br>
![image](https://github.com/user-attachments/assets/c9f09178-f44d-4d1f-a601-bc14c52b849b)

## Updates on $B^+$-Trees: Insertion
1. search-key valueì´ ë‚˜íƒ€ë‚  leaf nodeë¥¼ ì°¾ëŠ”ë‹¤.
2. search-key valueì´ leaf nodeì— ì´ë¯¸ ì¡´ì¬í•˜ë©´
   1. recordë¥¼ fileì— ì¶”ê°€í•œë‹¤.
   2. í•„ìš”í•˜ë‹¤ë©´ bucketì— ëŒ€í•œ pointerë¥¼ ì¶”ê°€í•œë‹¤.
      - ex) ì´ë¯¸ 'ê¹€ì² ìˆ˜'ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ë ˆì½”ë“œê°€ ìˆìœ¼ë©´, ê·¸ leaf nodeì— ìƒˆë¡œ ë“¤ì–´ì˜¨ 'ê¹€ì² ìˆ˜' ê°’(ì¦‰, ë˜ ë‹¤ë¥¸ 'ê¹€ì² ìˆ˜' ë ˆì½”ë“œ)ì„ ì¶”ê°€í•œë‹¤. <br>
  ê·¸ë¦¬ê³  ë§Œì•½ ê°™ì€ ì´ë¦„ì„ ê°€ì§„ ë ˆì½”ë“œê°€ ì—¬ëŸ¬ ê°œë¼ì„œ bucket(ì—¬ëŸ¬ ë ˆì½”ë“œë¥¼ ëª¨ì•„ë‘ëŠ” ê³µê°„)ì´ í•„ìš”í•˜ë‹¤ë©´, ê·¸ bucketì— ìƒˆ ë ˆì½”ë“œì˜ ìœ„ì¹˜ë¥¼ ê°€ë¦¬í‚¤ëŠ” pointerë„ ì¶”ê°€í•œë‹¤.
3. search-key valueì´ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´
   1. recordë¥¼ main fileì— ì¶”ê°€í•œë‹¤ (í•„ìš”í•˜ë‹¤ë©´ bucketë„ ìƒì„±).
   2. leaf nodeì— ê³µê°„(room)ì´ ìˆë‹¤ë©´, (key-value, pointer) ìŒì„ leaf nodeì— ì‚½ì…í•œë‹¤.
   3. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´, ìƒˆë¡œìš´ (key-value, pointer) í•­ëª©ê³¼ í•¨ê»˜ nodeë¥¼ splití•œë‹¤
- Splitting a leaf node:
  - ì‚½ì…í•  í•­ëª©ì„ í¬í•¨í•˜ì—¬ ì´ $n$ê°œì˜ (search-key value, pointer) ìŒì„ ì •ë ¬ëœ ìˆœì„œë¡œ ë‚˜ì—´í•œë‹¤. ì²˜ìŒ $âŒˆn/2âŒ‰$ê°œëŠ” ê¸°ì¡´ nodeì—, ë‚˜ë¨¸ì§€ëŠ” ìƒˆ nodeì— ë°°ì¹˜í•œë‹¤.
  - new nodeë¥¼ $p$, $p$ì—ì„œ ê°€ì¥ ì‘ì€ key valueì„ $k$ë¼ê³  í•˜ë©´, ë¶„í• ëœ ë…¸ë“œì˜ parent nodeì— $(k, p)$ë¥¼ ì‚½ì…í•œë‹¤.
  - parent nodeê°€ ê°€ë“ ì°¨ ìˆë‹¤ë©´, ê·¸ê²ƒë„ splití•˜ê³  ë¶„í• ì„ ìœ„ìª½ìœ¼ë¡œ ì „íŒŒí•œë‹¤.
- ë…¸ë“œ ë¶„í• ì€ ê°€ë“ ì°¨ì§€ ì•Šì€ ë…¸ë“œë¥¼ ë§Œë‚  ë•Œê¹Œì§€ ìœ„ë¡œ ê³„ì† ì§„í–‰ëœë‹¤.
  - worst case, root nodeê¹Œì§€ ë¶„í• ë˜ë©° height of theê°€ 1ë§Œí¼ ì¦ê°€í•  ìˆ˜ ìˆë‹¤. <br>

![image](https://github.com/user-attachments/assets/d0a8ad28-296f-4fc7-b407-4287f88b4412)

## $B^+$-Tree Insertion
![image](https://github.com/user-attachments/assets/058e45e9-a9f3-4221-92b2-a1c5dbe22532) <br>
![image](https://github.com/user-attachments/assets/94c94ce2-5e84-41a2-a59d-03fa71b7bd9c) <br>
ì—¬ê¸°ì„œ ë´ì•¼í•  1ê°€ì§€ íŠ¹ì´ì ì´ ìˆë‹¤. <br>
- Leaf Node Split vs Internal Node Splitì˜ ì°¨ì´
  - Lamportì˜ ê²½ìš° (Leaf Node Split): <br>
  LamportëŠ” leaf nodeì— ì‚½ì… -> split -> ìœ„ë¡œ ë³µì‚¬ -> ë”°ë¼ì„œ leaf + internal ë‘˜ë‹¤ ìˆë‹¤. <br> 
  ë‹¤ë§Œ í•´ë‹¹ nodeê°€ ê³„ì† ì˜¬ë¼ê°€ë©´ leaf + ìµœì¢… ë„ì°©í•œê³³ 2ê³³ì—ë§Œ ìˆë‹¤.
  - Goldì˜ ê²½ìš° (Internal Node Split): <br>
  GoldëŠ” Internal node splitì—ì„œëŠ” ì¤‘ê°„ key(Gold)ë¥¼ ë¶€ëª¨ë¡œ ì´ë™(push up/move up) í•œã„·. <br>
  ë”°ë¼ì„œ GoldëŠ” ì›ë˜ internal nodeì—ì„œ ì œê±°ë˜ê³  ìƒìœ„ ë…¸ë“œë¡œë§Œ ì˜¬ë¼ê°‘ë‹ˆë‹¤

## Insertion in B+-Trees (Cont.)
- Splitting a non node N-leaf node: ì´ë¯¸ ê°€ë“ ì°¬ ë‚´ë¶€ ë…¸ë“œì— (k, p)ë¥¼ insertingí•  ë•Œ
  - Nì„ n+1ê°œì˜ í¬ì¸í„°ì™€ nê°œì˜ í‚¤ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ì˜ì—­ Mìœ¼ë¡œ ë³µì‚¬í•œë‹¤
  - (k, p)ë¥¼ Mì— ì‚½ì…í•œë‹¤
  - Mì—ì„œ $P_1$, $K_1$, â€¦, $K_{âŒˆn/2âŒ‰-1}$, $P_{âŒˆn/2âŒ‰}$ë¥¼ ë‹¤ì‹œ ë…¸ë“œ Nì— ë³µì‚¬í•œë‹¤
  - Mì—ì„œ $P_{âŒˆn/2âŒ‰+1}$, $K_{âŒˆn/2âŒ‰+1}$, â€¦, $K_n$, $P_{n+1}$ë¥¼ ìƒˆë¡œ í• ë‹¹ëœ ë…¸ë“œ Nâ€™ì— ë³µì‚¬í•œë‹¤
  - ($K_{âŒˆn/2âŒ‰}$, Nâ€™)ë¥¼ ë…¸ë“œ Nì˜ ë¶€ëª¨ì— ì‚½ì…í•œë‹¤ <br>
ìœ„ì—ì„œ ì„¤ëª…í•œ Internalê´€ë ¨ì´ë‹¤. <br>
![image](https://github.com/user-attachments/assets/a65b943d-3053-4b0d-b9c0-effcb8e5ba5a) <br>
![image](https://github.com/user-attachments/assets/649a4843-b016-448a-a18d-889de72090e7) <br>
![image](https://github.com/user-attachments/assets/4c55125d-52be-4b44-b96e-a2bcf9e9b786) <br>

## Examples of $B^+$-Tree Deletion -> deletionì€ ìì„¸íˆX êµ¬í˜„X ì–´ëŠì •ë„ ì´í•´ë§Œ í•´ë‘ì
![image](https://github.com/user-attachments/assets/7efcc047-1fa1-4173-97f2-b3a288d7f435) <br>
![image](https://github.com/user-attachments/assets/d664dbe1-c42a-4fc9-b334-a487b29e0168) <br>
- Singhì™€ Wuë¥¼ í¬í•¨í•˜ëŠ” leafê°€ ë¶€ì¡±í•´ì ¸ì„œ left sibling nodeì—ì„œ Kim ê°’ì„ ë¹Œë ¸ë‹¤
- ê·¸ ê²°ê³¼ ë¶€ëª¨ ë…¸ë“œì˜  Search-key valueì´ ë³€ê²½ëœë‹¤ <br>

![image](https://github.com/user-attachments/assets/f3a9112c-f73f-4141-bbba-c55fd18c5ae5) <br>
Goldì™€ Katzë¥¼ ê°€ì§„ ë…¸ë“œê°€ ë¶€ì¡±í•´ì ¸ì„œ sibling ë…¸ë“œì™€ mergedë˜ì—ˆë‹¤ <br>
Parent ë…¸ë“œë„ ë¶€ì¡±í•´ì ¸ì„œ Parentì˜ sibling ë…¸ë“œì™€ ë³‘í•©ë˜ì—ˆë‹¤ <br>
  ë‘ ë…¸ë“œë¥¼ êµ¬ë¶„í•˜ëŠ” Value(ë¶€ëª¨ ë…¸ë“œì— ìˆëŠ” ê°’)ì´ ë³‘í•©ë  ë•Œ ì•„ë˜ë¡œ ë‚´ë ¤ì˜¨ë‹¤ <br>
Root ë…¸ë“œëŠ” ìì‹ì´ í•˜ë‚˜ë§Œ ë‚¨ì•„ ì‚­ì œëœë‹¤

## Updates on $B^+$-Trees: Deletion
- ì‚­ì œí•  ë ˆì½”ë“œë¥¼ ì°¾ì•„ main fileê³¼ bucket(ìˆë‹¤ë©´)ì—ì„œ ì œê±°í•œë‹¤
- ë²„í‚·ì´ ì—†ê±°ë‚˜ ë²„í‚·ì´ ë¹„ì–´ ìˆìœ¼ë©´, leaf ë…¸ë“œì—ì„œ (search-key value, pointer)ë¥¼ ì œê±°í•œë‹¤
- ì œê±°ë¡œ ì¸í•´ ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ ë„ˆë¬´ ì ê³ , í•´ë‹¹ ë…¸ë“œì™€ í˜•ì œ ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ í•˜ë‚˜ì˜ ë…¸ë“œì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆìœ¼ë©´, í˜•ì œ ë…¸ë“œë¥¼ ë³‘í•©í•œë‹¤:
  - ë‘ ë…¸ë“œì˜ ëª¨ë“  search-key valuesì„ í•˜ë‚˜ì˜ ë…¸ë“œ(ì™¼ìª½ ë…¸ë“œ)ì— ì‚½ì…í•˜ê³ , ë‹¤ë¥¸ ë…¸ë“œëŠ” ì‚­ì œí•œë‹¤
  - ì‚­ì œëœ ë…¸ë“œë¥¼ ê°€ë¦¬í‚¤ëŠ” pointer $ğ‘ƒ_i$ì™€ ìŒì„ ì´ë£¨ëŠ” ($K_{iâˆ’1}$, $p_i$)ë¥¼ ë¶€ëª¨ ë…¸ë“œì—ì„œ ì‚­ì œí•˜ë©°, ìœ„ ì ˆì°¨ë¥¼ ì¬ê·€ì (recursively)ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤
- ë§Œì•½ ì‚­ì œë¡œ ì¸í•´ ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ ë„ˆë¬´ ì ì§€ë§Œ, í•´ë‹¹ ë…¸ë“œì™€ sibling ë…¸ë“œì˜ ì—”íŠ¸ë¦¬ê°€ í•˜ë‚˜ì˜ ë…¸ë“œì— ë“¤ì–´ê°€ì§€ ì•ŠëŠ” ê²½ìš°ì—ëŠ” pointersë¥¼ ì¬ë¶„ë°°(redistribute)í•œë‹¤:
  - ë…¸ë“œì™€ sibling ë…¸ë“œ ì‚¬ì´ì— pointersë¥¼ ì¬ë¶„ë°°í•˜ì—¬ ë‘ ë…¸ë“œ ëª¨ë‘ ìµœì†Œ ì—”íŠ¸ë¦¬ ìˆ˜ ì´ìƒì´ ë˜ë„ë¡ í•œë‹¤.
  - ë…¸ë“œì˜ ë¶€ëª¨ì— ìˆëŠ” ëŒ€ì‘(corresponding)í•˜ëŠ” search-key valueì„ ì—…ë°ì´íŠ¸í•œë‹¤.
- ë…¸ë“œ ì‚­ì œëŠ” ìœ„ë¡œ ì—°ì‡„ì (cascade)ìœ¼ë¡œ ì§„í–‰ë  ìˆ˜ ìˆìœ¼ë©°, í¬ì¸í„°ê°€ âŒˆn/2âŒ‰ê°œ ì´ìƒì¸ ë…¸ë“œê°€ ë°œê²¬ë  ë•Œê¹Œì§€ ê³„ì†ëœë‹¤.
- ì‚­ì œ í›„ ë£¨íŠ¸ ë…¸ë“œì— í¬ì¸í„°ê°€ í•˜ë‚˜ë§Œ ë‚¨ìœ¼ë©´, ë£¨íŠ¸ ë…¸ë“œë¥¼ ì‚­ì œí•˜ê³  ê·¸ ìœ ì¼í•œ ìì‹ ë…¸ë“œê°€ ìƒˆë¡œìš´ ë£¨íŠ¸ê°€ ëœë‹¤. -> root node ì‚­ì œ -> levelì´ 1ê°œ down <br>

![image](https://github.com/user-attachments/assets/ed58d4b9-7871-44c8-9169-9dba5e1acae8)

## $B^+$-Tree File Organization
- Index fileì˜ ì—´í™”(degradation) ë¬¸ì œëŠ” $B^+$-Tree indicesë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í•´ê²°ëœë‹¤.
- Data fileì˜ ì—´í™”(degradation) ë¬¸ì œëŠ” B ì¡°ì§(B Organization)ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ í•´ê²°ëœë‹¤.
- $B^+$-tree file organizationì—ì„œëŠ” leaf ë…¸ë“œê°€ í¬ì¸í„° ëŒ€ì‹  ì‹¤ì œ ë ˆì½”ë“œë¥¼ ì €ì¥í•œë‹¤.
- leaf ë…¸ë“œëŠ” ì—¬ì „íˆ ì ˆë°˜ ì´ìƒ ì°¨ ìˆì–´ì•¼ í•œë‹¤.
  - recordsëŠ” pointersë³´ë‹¤ í¬ê¸° ë•Œë¬¸ì—, leaf ë…¸ë“œì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ìµœëŒ€ ë ˆì½”ë“œ ìˆ˜ëŠ” nonleaf nodeì— ì €ì¥í•  ìˆ˜ ìˆëŠ” í¬ì¸í„° ìˆ˜ë³´ë‹¤ ì ë‹¤.
- Insertionê³¼ deletionëŠ” $B^+$-tree indexì—ì„œì˜ ì‚½ì… ë° ì‚­ì œ ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ëœë‹¤.<br>

![image](https://github.com/user-attachments/assets/2a5cf496-d0b0-4baa-b625-8ed2c1bab730) <br>
- recordsëŠ” pointersë³´ë‹¤ ë” ë§ì€ ê³µê°„ì„ ì°¨ì§€í•˜ë¯€ë¡œ, ì¢‹ì€ space utilizationì´ ì¤‘ìš”í•˜ë‹¤.
- space utilizationë¥¼ ë†’ì´ê¸° ìœ„í•´, ë¶„í• (split) ë° ë³‘í•©(merge) ì‹œ ë” ë§ì€ sibling ë…¸ë“œë¥¼ ì¬ë¶„ë°°ì— ì°¸ì—¬ì‹œí‚¨ë‹¤.
  - ê°€ëŠ¥í•œ ë¶„í• /ë³‘í•©ì„ í”¼í•˜ê¸° ìœ„í•´ í˜•ì œ ë…¸ë“œ 2ê°œë¥¼ ì¬ë¶„ë°°ì— í¬í•¨ì‹œí‚¤ë©´, ê° ë…¸ë“œëŠ” ìµœì†Œ âŒŠ2n/3âŒ‹ê°œì˜ ì—”íŠ¸ë¦¬ë¥¼ ê°–ê²Œ ëœë‹¤. <br>
![image](https://github.com/user-attachments/assets/9eafbf99-8230-4198-9df8-5647fcfe0ff0)

## Other Issues in Indexing
- Record ì¬ë°°ì¹˜(relocation)ì™€ secondary indices
  - ë ˆì½”ë“œê°€ ì´ë™í•˜ë©´, ë ˆì½”ë“œ í¬ì¸í„°ë¥¼ ì €ì¥í•˜ëŠ” ëª¨ë“  secondary indicesë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•œë‹¤.
  - $B^+$-tree file organizationsì—ì„œì˜ ë…¸ë“œ ë¶„í• ì€ ë§¤ìš° ë¹„ìš©ì´ ë§ì´ ë“ ë‹¤. -> ìœ„ì˜ ì´ìœ ë•Œë¬¸
  - Solution: secondary indexì— ë ˆì½”ë“œ í¬ì¸í„° ëŒ€ì‹  ê¸°ë³¸ ì¸ë±ìŠ¤ ê²€ìƒ‰ í‚¤(primary-index search key)ë¥¼ ì‚¬ìš©í•œë‹¤.
  - ë ˆì½”ë“œë¥¼ ì°¾ê¸° ìœ„í•´ ê¸°ë³¸ ì¸ë±ìŠ¤(primary index)ë¥¼ ì¶”ê°€ë¡œ íƒìƒ‰(traversal)í•´ì•¼ í•˜ë¯€ë¡œ ì¿¼ë¦¬(queries) ë¹„ìš©ì€ ì¦ê°€í•˜ì§€ë§Œ, ë…¸ë“œ splitsì€ ì €ë ´í•´ì§„ë‹¤.
  - ê¸°ë³¸ ì¸ë±ìŠ¤ ê²€ìƒ‰ í‚¤(primary-index search key)ê°€ ìœ ì¼í•˜ì§€ ì•Šë‹¤ë©´ ë ˆì½”ë“œ ID(record-id)ë¥¼ ì¶”ê°€í•œë‹¤.<br>

![image](https://github.com/user-attachments/assets/ce17924e-5e08-4849-a731-fb9f967a0861)
